<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø« - RCC - ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/android-chrome-512x512.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Data Sync Scripts -->
    <script src="sync-manager.js"></script>
    <script src="localStorage-wrapper.js"></script>
    <script src="edit-facility-beds.js"></script>
    
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
@import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap');
        * { font-family: 'Cairo', sans-serif; }
        
        /* Ø¥Ø²Ø§Ù„Ø© Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar {
            display: none;
        }
        
        html, body {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* ØªØ®Ø·ÙŠØ· Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© */
        html, body {
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        
        .fullscreen-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .compact-container {
            width: 100%;
            max-width: none;
            padding: 0.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        /* ØªØµØºÙŠØ± Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø¹Ù†Ø§ØµØ± */
        .compact-card {
            padding: 0.75rem !important;
        }
        
        .compact-text {
            font-size: 0.875rem;
        }
        
        .compact-title {
            font-size: 1.125rem;
        }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø­Ø³Ù†Ø© */
        .professional-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin: 0 auto 8px auto;
            position: relative;
            overflow: hidden;
        }
        
        .professional-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .professional-icon:hover::before {
            left: 100%;
        }
        
        .professional-icon:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø§Ù„Ø­Ø¯ÙŠØ«Ø© */
        .icon-staff {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(124, 58, 237, 0.2));
            color: #8b5cf6;
        }
        
        .icon-life-saving {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.2));
            color: #ef4444;
        }
        
        .icon-moderate {
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(234, 88, 12, 0.2));
            color: #f97316;
        }
        
        .icon-stable {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.2));
            color: #22c55e;
        }
        
        .icon-home {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.2));
            color: #3b82f6;
        }
        
        .icon-health-center {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.3), rgba(8, 145, 178, 0.2));
            color: #06b6d4;
        }
        
        .icon-target {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.2));
            color: #10b981;
        }
        
        .icon-team {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.3), rgba(8, 145, 178, 0.2));
            color: #06b6d4;
        }
        
        .icon-clock {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(217, 119, 6, 0.2));
            color: #f59e0b;
        }
        
        .icon-weather {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.2));
            color: #3b82f6;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .enhanced-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .enhanced-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .enhanced-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ */
        .enhanced-number {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .enhanced-label {
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø³Ù…ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
        label {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            height: auto !important;
            overflow: visible !important;
            white-space: normal !important;
        }
        
        .login-form label {
            color: #ffffff !important;
            font-weight: 500 !important;
            margin-bottom: 8px !important;
            padding: 0 !important;
            line-height: 1.4 !important;
        }
        
        .enhanced-subtitle {
            font-size: 0.8rem;
            opacity: 0.8;
            font-weight: 500;
        }
        
        .compact-number {
            font-size: 1.5rem;
        }
        
        .compact-spacing {
            gap: 0.5rem;
        }
        
        .animated-bg {
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #0f3460, #533483);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .pulse-bg {
            background: radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            animation: pulse 4s ease-in-out infinite;
        }
        
        .emergency-glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3), 0 0 40px rgba(99, 102, 241, 0.2);
            animation: emergencyPulse 2s ease-in-out infinite;
        }
        
        @keyframes emergencyPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3), 0 0 40px rgba(99, 102, 241, 0.2); }
            50% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 60px rgba(99, 102, 241, 0.4); }
        }
        
        /* ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù */
        .ambulance-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }
        
        .flash-red {
            position: absolute;
            top: 20%;
            left: 10%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255, 0, 0, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(40px);
            animation: flashRed 2s ease-in-out infinite;
        }
        
        .flash-blue {
            position: absolute;
            top: 60%;
            right: 15%;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, rgba(0, 100, 255, 0.4) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(50px);
            animation: flashBlue 2.5s ease-in-out infinite;
        }
        
        .flash-white {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            filter: blur(30px);
            animation: flashWhite 1.8s ease-in-out infinite;
        }
        
        @keyframes flashRed {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
        
        @keyframes flashBlue {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.3); }
        }
        
        @keyframes flashWhite {
            0%, 100% { opacity: 0.1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.4; transform: translateX(-50%) scale(1.1); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
        }
        
        .status-indicator {
            animation: statusBlink 2s ease-in-out infinite;
        }
        
        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .zoom-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .print-btn {
            position: fixed;
            top: 20px;
            left: 80px;
            z-index: 1000;
            display: none;
        }
        
        .print-btn.admin-mode {
            display: block;
        }
        
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .scale-75 { transform: scale(0.75); }
        .scale-90 { transform: scale(0.9); }
        .scale-110 { transform: scale(1.1); }
        .scale-125 { transform: scale(1.25); }
        
        /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø­Ø¯ÙŠØ«Ø© ÙˆØ´ÙØ§ÙØ© */
        .modern-icon {
            font-size: 3rem;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .modern-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(0,0,0,0.2);
        }
        
        .icon-staff {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(139, 92, 246, 0.1));
            color: #a78bfa;
        }
        
        .icon-ambulance {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(34, 197, 94, 0.1));
            color: #4ade80;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .icon-health {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(59, 130, 246, 0.1));
            color: #60a5fa;
        }
        
        .icon-emergency {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(239, 68, 68, 0.1));
            color: #f87171;
        }
        
        .icon-time {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(245, 158, 11, 0.1));
            color: #fbbf24;
        }
        
        .icon-centers {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(99, 102, 241, 0.1));
            color: #818cf8;
        }
        
        /* Ø´Ø¹Ø§Ø± Ø§Ù„Ø¥Ø³Ø¹Ø§Ù Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .professional-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .professional-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 40px rgba(220, 38, 38, 0.4);
        }
        
        .professional-logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: logoShine 3s ease-in-out infinite;
        }
        
        @keyframes logoShine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }
        
        .logo-cross {
            color: white;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        /* ØªØ­Ø³ÙŠÙ† ØªØ¹Ø¯ÙŠÙ„ Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
        .response-time-edit {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .response-time-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            color: white;
            padding: 10px;
            border-radius: 8px;
            width: 100px;
            text-align: center;
        }
        
        .response-time-input:focus {
            outline: none;
            border-color: rgba(245, 158, 11, 0.6);
            box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
        }
        
        @keyframes spin-slow {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }
        
        .settings-btn button:hover .animate-spin-slow {
            animation-duration: 2s;
        }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø· */
        .settings-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 16px;
            padding: 24px;
            width: 320px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            display: none;
            z-index: 1000;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .settings-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .settings-dropdown select,
        .settings-dropdown input {
            background: rgba(51, 65, 85, 0.8) !important;
            border: 1px solid rgba(139, 92, 246, 0.3) !important;
            color: white !important;
            border-radius: 8px !important;
            padding: 8px 12px !important;
            font-size: 14px !important;
            width: 100% !important;
            transition: all 0.3s ease !important;
        }
        
        .settings-dropdown select:focus,
        .settings-dropdown input:focus {
            border-color: rgba(139, 92, 246, 0.6) !important;
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2) !important;
            outline: none !important;
        }
        
        .settings-dropdown label {
            color: #e2e8f0 !important;
            font-weight: 500 !important;
            margin-bottom: 8px !important;
            display: block !important;
            font-size: 14px !important;
        }
        
        .zoom-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 12px;
        }
        
        .zoom-btn {
            background: rgba(139, 92, 246, 0.8) !important;
            border: none !important;
            color: white !important;
            padding: 6px 12px !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            font-size: 12px !important;
            transition: all 0.3s ease !important;
        }
        
        .zoom-btn:hover {
            background: rgba(139, 92, 246, 1) !important;
            transform: translateY(-1px);
        }
        
        #zoomLevel {
            color: #a78bfa !important;
            font-weight: bold !important;
            min-width: 40px !important;
            text-align: center !important;
        }
        
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .login-form {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            padding: 40px;
            width: 400px;
            max-width: 90vw;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: white;
            border-radius: 8px;
            padding: 12px;
            width: 100%;
        }

        .form-input:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .btn-secondary {
            background: rgba(107, 114, 128, 0.8);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(107, 114, 128, 1);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-success:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .login-title {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
        }

        .login-input:focus {
            outline: none;
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
        }

        .login-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.3);
        }

        .login-error {
            color: #f87171;
            margin-top: 10px;
            font-size: 14px;
        }
        
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; }
            .animated-bg { background: white !important; }
            .card-hover { background: white !important; border: 1px solid #ccc !important; }
            .text-white { color: black !important; }
            .emergency-glow { box-shadow: none !important; }
            .ambulance-flash { display: none !important; }
            .pulse-bg { display: none !important; }
        }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }

        .notification {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(22, 163, 74, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 10px;
            color: white;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3);
            transform: translateX(100%);
            opacity: 0;
            animation: slideInNotification 0.5s ease-out forwards;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notification.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
            border-color: rgba(239, 68, 68, 0.3);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .notification.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9), rgba(217, 119, 6, 0.9));
            border-color: rgba(245, 158, 11, 0.3);
            box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
        }

        .notification.info {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.9));
            border-color: rgba(59, 130, 246, 0.3);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            opacity: 0.9;
        }

        @keyframes slideInNotification {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutNotification {
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        .notification.slide-out {
            animation: slideOutNotification 0.3s ease-in forwards;
        }

        /* Ø¯Ø¹Ù… Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ø¹Ø±ÙŠØ¶Ø© Ø¬Ø¯Ø§Ù‹ Ù„Ø¹Ø±Ø¶ 7 Ù…Ø±Ø§ÙƒØ² */
        @media (min-width: 1536px) {
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4.\\32 xl\\:grid-cols-5.\\33 xl\\:grid-cols-6.\\34 xl\\:grid-cols-7 {
                grid-template-columns: repeat(5, minmax(0, 1fr));
            }
        }

        @media (min-width: 1800px) {
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4.\\32 xl\\:grid-cols-5.\\33 xl\\:grid-cols-6.\\34 xl\\:grid-cols-7 {
                grid-template-columns: repeat(6, minmax(0, 1fr));
            }
        }

        @media (min-width: 2100px) {
            .grid-cols-1.md\\:grid-cols-2.lg\\:grid-cols-3.xl\\:grid-cols-4.\\32 xl\\:grid-cols-5.\\33 xl\\:grid-cols-6.\\34 xl\\:grid-cols-7 {
                grid-template-columns: repeat(7, minmax(0, 1fr));
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ ÙƒØ±ÙˆØª Ø§Ù„Ù…Ø±Ø§ÙƒØ² */
        .center-card {
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        .center-card .grid {
            gap: 8px !important;
        }

        .center-card .grid-cols-2 > div {
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px !important;
        }

        .center-card .grid-cols-3 > div {
            min-height: 35px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 6px !important;
        }

        .center-card p {
            margin: 0 !important;
            line-height: 1.2 !important;
        }

        .center-card .text-xs {
            font-size: 10px !important;
        }

        .center-card .text-sm {
            font-size: 12px !important;
        }
    

/* --- Split from emergency_dashboard_clean_final.html --- */


                        body { font-family: Arial, sans-serif; direction: rtl; }
                        .bg-white-5 {background: #f5f5f5;border: 1px solid #ddd;}
                        .rounded-lg { border-radius: 8px; }
                        .p-4 { padding: 16px; }
                        .mb-4 { margin-bottom: 16px; }
                        .grid { display: grid; }
                        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
                        .gap-4 { gap: 16px; }
                        .text-center { text-align: center; }
                        .font-bold { font-weight: bold; }
                        .text-xl { font-size: 1.25rem; }
                        .text-lg { font-size: 1.125rem; }
                        .text-sm { font-size: 0.875rem; }
                        .text-xs { font-size: 0.75rem; }
                        .mt-4 { margin-top: 16px; }
                        .space-y-3 > * + * { margin-top: 12px; }
                    

/* --- Split from emergency_dashboard_clean_final.html --- */


                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .data-table { width: 100%; border-collapse: collapse; }
                        .data-table th, .data-table td { border: 1px solid #ddd; padding: 12px; text-align: right; }
                        .data-table th { background-color: #f5f5f5; }

/* ===== Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ===== */

/* Ø£Ù†Ù…Ø§Ø· ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© */
.medical-case-edit {
    margin-top: 12px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.medical-case-input {
    width: 80px;
    padding: 6px 12px;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    font-size: 14px;
    text-align: center;
}

.medical-case-input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    background: rgba(255, 255, 255, 0.15);
}

.medical-case-input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© */
.icon-life-saving {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.2));
    color: #ef4444;
}

.icon-emergency {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(217, 119, 6, 0.2));
    color: #f59e0b;
}

.icon-stable {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.2));
    color: #22c55e;
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© */
.card-hover:hover .medical-case-edit {
    background: rgba(255, 255, 255, 0.15);
}

/* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
.admin-medical-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
    margin-top: 16px;
}

.admin-medical-buttons button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 16px;
    border-radius: 12px;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
}

.admin-medical-buttons button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
@media (max-width: 768px) {
    .medical-case-edit {
        padding: 8px;
    }
    
    .medical-case-input {
        width: 60px;
        padding: 4px 8px;
        font-size: 12px;
    }
    
    .admin-medical-buttons {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .admin-medical-buttons button {
        padding: 10px 12px;
        font-size: 14px;
    }
}


    </style>
</head>
<body class="animated-bg fullscreen-layout relative overflow-x-auto" id="mainBody">
    <!-- Ø­Ø§ÙˆÙŠ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div id="notificationContainer" class="notification-container"></div>
    
    <!-- ØªØ£Ø«ÙŠØ± ÙˆÙ…ÙŠØ¶ Ø§Ù„Ø¥Ø³Ø¹Ø§Ù -->
    <div class="ambulance-flash">
        <div class="flash-red"></div>
        <div class="flash-blue"></div>
        <div class="flash-white"></div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainProtectionModal" class="fixed inset-0 bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center z-50">
        <div class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 border border-white/20 shadow-2xl max-w-md w-full mx-4">
                <div class="text-center">
                <div class="text-6xl mb-6">ğŸ”</div>
                <h2 class="text-3xl font-bold text-white mb-4">Ø¯Ø®ÙˆÙ„ Ù…Ø­Ù…ÙŠ</h2>
                <p class="text-white/70 mb-8">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</p>
                
                <div class="space-y-4">
                    <input type="password" id="mainProtectionPassword" class="w-full bg-white/10 border border-white/20 rounded-xl px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
                    
                    <div id="mainProtectionError" class="text-red-400 text-sm hidden">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
                    
                    <button onclick="checkMainPassword()" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-200 transform hover:scale-105">
                        ğŸš€ Ø¯Ø®ÙˆÙ„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© -->
    <div class="fixed inset-0 pulse-bg pointer-events-none"></div>
    <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-1/4 right-1/4 w-96 h-96 bg-indigo-500/10 rounded-full blur-3xl animate-pulse delay-1000"></div>
    <div class="absolute top-1/2 left-1/2 w-32 h-32 bg-white/5 rounded-full blur-2xl animate-ping"></div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginModal" class="login-modal" style="display: none;">
        <div class="login-form">
            <div class="login-title">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
            <input type="password" id="loginPassword" class="login-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
            <div id="loginError" class="login-error" style="display: none;"></div>
            <button onclick="attemptLogin()" class="login-btn">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="cancelLogin()" class="btn-secondary mt-3 w-full">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="fullscreen-btn no-print">
        <button onclick="toggleFullscreen()" class="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full shadow-lg emergency-glow">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path>
            </svg>
        </button>
        <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµØ­ÙŠØ© ØªØ­Øª Ø§Ù„Ø²Ø± -->
        <div id="facilitiesCardsContainer" class="mt-4 space-y-3 no-print hidden" style="width: 100%; max-height: calc(100vh - 150px); overflow-y-auto; padding-right: 5px;">
            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
        </div>
    </div>

    <div class="print-btn no-print" id="printButton">
        <button onclick="printDashboard()" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-full shadow-lg">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
            </svg>
        </button>
    </div>

    <div class="settings-btn no-print">
        <div class="relative">
            <button onclick="toggleSettings()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white p-3 rounded-full shadow-xl transition-all duration-300 hover:scale-110 hover:shadow-2xl">
                <svg class="w-6 h-6 animate-spin-slow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
            <div id="settingsDropdown" class="settings-dropdown">
                <div class="mb-4">
                    <label class="block text-white font-medium text-sm mb-2">Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:</label>
                    <select id="refreshInterval" onchange="setRefreshInterval()" class="form-input text-sm">
                        <option value="5000">5 Ø«ÙˆØ§Ù†</option>
                        <option value="10000">10 Ø«ÙˆØ§Ù†</option>
                        <option value="15000">15 Ø«Ø§Ù†ÙŠØ©</option>
                        <option value="30000">30 Ø«Ø§Ù†ÙŠØ©</option>
                        <option value="60000">Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                        <option value="300000">5 Ø¯Ù‚Ø§Ø¦Ù‚</option>
                        <option value="900000">15 Ø¯Ù‚ÙŠÙ‚Ø©</option>
                        <option value="0">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«</option>
                    </select>
                </div>
                <div class="mb-4">
                    <div class="flex items-center justify-between">
                        <span class="text-white text-sm">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„:</span>
                        <div class="flex items-center space-x-2 space-x-reverse">
                            <div class="status-indicator w-3 h-3 bg-green-400 rounded-full"></div>
                            <span class="text-green-300 text-xs">Ù…ØªØµÙ„</span>
                        </div>
                    </div>
                </div>
                <div class="mb-4">
                    <span class="text-white/80 text-xs">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">Ø§Ù„Ø¢Ù†</span></span>
                </div>
                <div class="border-t border-white/20 pt-3">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-white text-sm">Ø§Ù„ØªÙƒØ¨ÙŠØ±:</span>
                        <span class="text-white text-sm" id="zoomLevel">100%</span>
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="zoomOut()" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg flex-1">
                            <svg class="w-4 h-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                            </svg>
                        </button>
                        <button onclick="resetZoom()" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg flex-1 text-xs">
                            Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                        </button>
                        <button onclick="zoomIn()" class="bg-white/20 hover:bg-white/30 text-white p-2 rounded-lg flex-1">
                            <svg class="w-4 h-4 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="border-t border-white/20 pt-3 mt-3">
                    <div class="space-y-2">
                        <button onclick="manualSave()" class="w-full bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg text-sm font-medium transition-all duration-200">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button onclick="exportData()" class="w-full bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg text-sm font-medium transition-all duration-200">
                            ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button onclick="clearStoredData()" class="w-full bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg text-sm font-medium transition-all duration-200">
                            ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ù…Ø­Ù…ÙŠ -->
    <div id="protectedContent" class="hidden">
    <div class="relative z-10 compact-container" id="dashboardContent">
        <!-- Ø§Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
        <div class="flex compact-spacing h-full gap-6 items-start">
            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠØ³Ø± - Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
            <div class="hidden lg:block w-72 space-y-4 mt-20">
                <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙØ±Ù‚ -->
                <div class="bg-gradient-to-br from-cyan-500/20 to-cyan-600/10 backdrop-blur-lg rounded-2xl p-4 border border-cyan-300/20 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-cyan-200 text-sm font-medium">Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø£Ø³Ø¹Ø§ÙÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
                            <p class="text-2xl font-bold text-white" id="availableTeams">0</p>
                            <p class="text-cyan-300 text-xs">ÙØ±ÙŠÙ‚ Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        </div>
                        <div class="professional-icon icon-team">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
                <div class="bg-gradient-to-br from-green-500/20 to-green-600/10 backdrop-blur-lg rounded-2xl p-4 border border-green-300/20 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-200 text-sm font-medium">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</p>
                            <p class="text-2xl font-bold text-white" id="quickStats">0</p>
                            <p class="text-green-300 text-xs">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                        </div>
                        <div class="professional-icon" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.2)); color: #22c55e;">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M3 3v18h18"/>
                                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª -->
                <div class="bg-gradient-to-br from-orange-500/20 to-orange-600/10 backdrop-blur-lg rounded-2xl p-4 border border-orange-300/20 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-orange-200 text-sm font-medium">Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</p>
                            <p class="text-2xl font-bold text-white" id="vehicleStatus">0</p>
                            <p class="text-orange-300 text-xs">Ø¥Ø³Ø¹Ø§Ù Ø¬Ø§Ù‡Ø² Ù„Ù„Ø®Ø¯Ù…Ø©</p>
                        </div>
                        <div class="professional-icon" style="background: linear-gradient(135deg, rgba(249, 115, 22, 0.3), rgba(234, 88, 12, 0.2)); color: #f97316;">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
                                <path d="M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0"/>
                                <path d="M5 17h-2v-6l2-5h9l4 5h1a2 2 0 0 1 2 2v4h-2m-4 0h-6m-6 -6h15m-6 0v-5"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø© -->
                <div class="bg-gradient-to-br from-gray-500/20 to-gray-600/10 backdrop-blur-lg rounded-2xl p-4 border border-gray-300/20 card-hover">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-200 text-sm font-medium">Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©</p>
                            <p class="text-2xl font-bold text-white" id="outOfServiceTotal">0</p>
                            <p class="text-gray-300 text-xs">Ø¥Ø³Ø¹Ø§Ù</p>
                        </div>
                        <div class="professional-icon" style="background: linear-gradient(135deg, rgba(107, 114, 128, 0.3), rgba(75, 85, 99, 0.2)); color: #9ca3af;">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© -->
                <div class="bg-gradient-to-br from-red-500/20 to-red-600/10 backdrop-blur-lg rounded-2xl p-4 border border-red-300/20 card-hover" onclick="if(isAdminMode) openLifeSavingReferralsModal()" style="cursor: pointer;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-200 text-sm font-medium">Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</p>
                            <p class="text-2xl font-bold text-white" id="lifeSavingReferralsCount">0</p>
                            <p class="text-red-300 text-xs">Ø­Ø§Ù„Ø© Ø­Ø±Ø¬Ø©</p>
                        </div>
                        <div class="professional-icon" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(220, 38, 38, 0.2)); color: #ef4444;">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                <circle cx="12" cy="12" r="2" fill="currentColor" opacity="0.6"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø­Ø§Ù„Ø§Øª Ø·Ø§Ø±Ø¦Ø© -->
                <div class="bg-gradient-to-br from-yellow-500/20 to-yellow-600/10 backdrop-blur-lg rounded-2xl p-4 border border-yellow-300/20 card-hover" onclick="if(isAdminMode) openEmergencyReferralsModal()" style="cursor: pointer;">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-200 text-sm font-medium">Ø¥Ø­Ø§Ù„Ø§Øª Ø·Ø§Ø±Ø¦Ø©</p>
                            <p class="text-2xl font-bold text-white" id="emergencyReferralsCount">0</p>
                            <p class="text-yellow-300 text-xs">Ø­Ø§Ù„Ø© Ø·Ø§Ø±Ø¦Ø©</p>
                        </div>
                        <div class="professional-icon" style="background: linear-gradient(135deg, rgba(234, 179, 8, 0.3), rgba(202, 138, 4, 0.2)); color: #eab308;">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© -->
                <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/10 backdrop-blur-lg rounded-2xl p-3 border border-blue-300/20 card-hover" onclick="if(isAdminMode) openServicePurchaseModal()" style="cursor: pointer;">
                    <div class="mb-2">
                        <p class="text-blue-200 text-xs font-medium mb-2">Ø´Ø±Ø§Ø¡ Ø®Ø¯Ù…Ø©</p>
                        <div class="grid grid-cols-2 gap-1">
                            <div class="bg-blue-500/20 rounded-lg p-1.5 text-center border border-blue-300/30">
                                <p class="text-blue-300 text-xs mb-0.5">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</p>
                                <p class="text-lg font-bold text-white" id="servicePurchaseTotalCount">0</p>
                            </div>
                            <div class="bg-green-500/20 rounded-lg p-1.5 text-center border border-green-300/30">
                                <p class="text-green-300 text-xs mb-0.5">Ø§Ù„Ù†Ù‚Ù„</p>
                                <p class="text-lg font-bold text-white" id="servicePurchaseTransferredCount">0</p>
                            </div>
                            <div class="bg-red-500/20 rounded-lg p-1.5 text-center border border-red-300/30">
                                <p class="text-red-300 text-xs mb-0.5">Ø§Ù„Ø±ÙØ¶</p>
                                <p class="text-lg font-bold text-white" id="servicePurchaseRejectedCount">0</p>
                            </div>
                            <div class="bg-yellow-500/20 rounded-lg p-1.5 text-center border border-yellow-300/30">
                                <p class="text-yellow-300 text-xs mb-0.5">ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</p>
                                <p class="text-lg font-bold text-white" id="servicePurchaseUnderProcessCount">0</p>
                            </div>
                        </div>
                        <div class="bg-purple-500/20 rounded-lg p-1.5 text-center border border-purple-300/30 mt-1">
                            <p class="text-purple-300 text-xs mb-0.5">Ø£Ø®Ø±Ù‰</p>
                            <p class="text-lg font-bold text-white" id="servicePurchaseOtherCount">0</p>
                        </div>
                    </div>
                </div>

                <!-- Ø¨Ø·Ø§Ù‚Ø© Mobile Medical Team -->
                <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/10 backdrop-blur-lg rounded-2xl p-3 border border-blue-300/20 card-hover" onclick="if(isAdminMode) openMobileTeamModal()" style="cursor: pointer;">
                    <div class="mb-2">
                        <div class="flex justify-between items-center mb-2">
                            <p class="text-blue-200 text-xs font-medium">Mobile Medical Team</p>
                            <p class="text-blue-300 text-lg font-bold" id="mobileTeamTotalCount">0</p>
                        </div>
                        <div id="mobileTeamsList" class="space-y-1">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                        </div>
                    </div>
                </div>


            </div>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
            <div class="flex-1 flex flex-col">
                <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
                <div class="bg-white/10 backdrop-blur-lg rounded-xl compact-card mb-4 border border-purple-300/20 emergency-glow">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <!-- Ø´Ø¹Ø§Ø± ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
                        <div class="flex items-center">
                            <img src="assets/logo.png" alt="Ø´Ø¹Ø§Ø± ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ" class="h-16 w-auto mr-4" style="filter: brightness(1.1) contrast(1.1);">
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-white">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø« - RCC</h1>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3 space-x-reverse">
                    <div id="viewModeButtons" class="flex items-center space-x-2 space-x-reverse">
                        <button onclick="showViewMode()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-xl font-medium transition-all duration-200">
                            ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶
                        </button>
                        <button id="adminModeButton" onclick="showAdminMode()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-xl font-medium transition-all duration-200" style="display: none;">
                            ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                        </button>
                        <div class="bg-white/10 backdrop-blur-lg rounded-xl px-4 py-2 border border-white/20">
                            <div class="flex flex-col items-center">
                                <span class="text-white text-xs font-medium" id="currentDay">---</span>
                                <span class="text-white text-xs font-medium" id="currentDate">--/--/----</span>
                                <span class="text-white text-sm font-bold" id="currentTime">--:--:--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ© -->
        <div id="emergencyAlert" class="mb-6 bg-gradient-to-r from-red-600 to-red-700 border-2 border-red-500 rounded-xl p-4 shadow-lg animate-pulse" style="display: none;">
            <div class="flex items-center space-x-4 space-x-reverse">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-white rounded-full flex items-center justify-center">
                        <span id="emergencyIcon" class="text-red-600 text-lg">ğŸš¨</span>
                    </div>
                </div>
                <div class="flex-1">
                    <h3 class="text-white font-bold text-lg mb-1">ğŸ”´ Ø£Ø­Ø¯Ø§Ø« Ø¬Ø§Ø±ÙŠØ©</h3>
                    <p id="emergencyText" class="text-white/90 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø¬Ø§Ø±ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
                <div class="flex-shrink-0">
                    <div class="w-3 h-3 bg-red-300 rounded-full animate-ping"></div>
                </div>
            </div>
        </div>

        <!-- ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ø³ØªØ© -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8"></div>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© -->
        <div id="adminControls" class="mb-8 no-print" style="display: none;">
            <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-purple-300/20">
                <div class="flex flex-wrap gap-4 justify-center">
                       <button onclick="showAddCenterModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                        <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ</span>
                    </button>
                    <button onclick="openFacilityModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <span>Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´Ø£Ø©</span>
                    </button>
                    <button onclick="showQuickEditModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        <span>ØªØ¹Ø¯ÙŠÙ„ Ø³Ø±ÙŠØ¹</span>
                    </button>
                    <button onclick="showExportModal()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span>ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    </button>
                    <button onclick="showCasesSummaryModal()" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©</span>
                    </button>
                    <button onclick="showHistoricalDataModal()" class="bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <span>Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ù…Ù†ÙŠ</span>
                    </button>
                    <button onclick="showChangePasswordModal()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1721 9z"></path>
                        </svg>
                        <span>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</span>
                    </button>
                    <button onclick="showEmergencyAlertModal()" class="bg-red-800 hover:bg-red-900 text-white px-6 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse border-2 border-red-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        <span>ğŸš¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</span>
                    </button>
                </div>
            </div>
        </div>



        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§ÙƒØ² -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 3xl:grid-cols-6 4xl:grid-cols-7 gap-6" id="centersGrid">
            <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ù‡Ù†Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
        </div>


            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ø£ÙŠÙ…Ù† - Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© -->
            <div class="w-full xl:w-72 space-y-4 mt-20">
                
                <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© -->
                <div id="customCentersContainer" class="space-y-3">
                    <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² -->
    <div id="addCenterModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 600px; max-width: 95vw;">
            <div class="login-title">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ Ø¬Ø¯ÙŠØ¯</div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²:</label>
                    <input type="text" id="centerName" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ù…Ù‚Ø± Ø§Ù„Ù…Ø±ÙƒØ²:</label>
                    <input type="text" id="centerLocation" class="form-input" placeholder="Ù…Ù‚Ø± Ø§Ù„Ù…Ø±ÙƒØ²">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙƒÙ„ÙŠ:</label>
                    <input type="number" id="totalStaffInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙƒÙ„ÙŠ">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                    <input type="number" id="currentStaffInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©:</label>
                    <input type="number" id="totalAmbulancesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©:</label>
                    <input type="number" id="activeAmbulancesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©:</label>
                    <input type="number" id="inactiveAmbulancesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø¯Ø¹Ù…:</label>
                    <input type="number" id="supportAmbulancesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ø¯Ø¹Ù…">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©:</label>
                    <input type="number" id="lifeSavingCasesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„:</label>
                    <input type="number" id="homeCasesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©:</label>
                    <input type="number" id="moderateCasesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©:</label>
                    <input type="number" id="stableCasesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©:</label>
                    <input type="number" id="healthCenterCasesInput" class="form-input" placeholder="Ø¹Ø¯Ø¯ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©">
                </div>
            </div>
            <div class="flex space-x-3 space-x-reverse mt-6">
                <button id="addCenterBtn" onclick="addCenter()" class="btn-primary flex-1">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ²</button>
                <button onclick="closeAddCenterModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ -->
    <div id="quickEditModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 800px; max-width: 95vw; max-height: 90vh; overflow-y: auto;">
            <div class="login-title">âš¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø±Ø§ÙƒØ²</div>
            <div id="quickEditContent">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù‡Ù†Ø§ -->
            </div>
            <div class="flex space-x-3 space-x-reverse mt-6">
                <button onclick="saveQuickEdit()" class="btn-success flex-1">ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                <button onclick="closeQuickEditModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <div id="exportModal" class="login-modal" style="display: none;">
        <div class="login-form">
            <div class="login-title">ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="text-white/70 mb-6">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
            <div class="space-y-3">
                <button onclick="exportToExcel()" class="btn-success w-full">ğŸ“Š ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel</button>
                <button onclick="exportToPDF()" class="btn-primary w-full">ğŸ“„ ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF</button>
                <button onclick="printDashboard()" class="btn-secondary w-full">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
            </div>
            <button onclick="closeExportModal()" class="btn-secondary w-full mt-4">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª -->
    <div id="casesSummaryModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 800px; max-width: 95vw; max-height: 90vh; overflow-y: auto;">
            <div class="flex justify-between items-center mb-6">
                <div class="login-title">ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©</div>
                <button onclick="printCasesSummary()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm">
                    ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>
            <div id="casesSummaryContent">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù‡Ù†Ø§ -->
            </div>
            <button onclick="closeCasesSummaryModal()" class="btn-secondary w-full mt-4">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© -->
    <div id="historicalDataModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 700px; max-width: 95vw;">
            <div class="login-title">ğŸ“… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©</div>
            <div class="text-white/70 mb-6">Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                <input type="date" id="historicalDate" class="form-input" value="">
            </div>
            <div class="flex space-x-2 space-x-reverse mb-4">
                <button onclick="loadTodayData()" class="btn-primary flex-1">Ø§Ù„ÙŠÙˆÙ…</button>
                <button onclick="loadYesterdayData()" class="btn-secondary flex-1">Ø£Ù…Ø³</button>
            </div>
            <div id="historicalDataContent" class="mb-4">
                <!-- Ø³ÙŠØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù‡Ù†Ø§ -->
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="loadHistoricalData()" class="btn-success flex-1">Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                <button onclick="closeHistoricalDataModal()" class="btn-secondary flex-1">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± -->
    <div id="changePasswordModal" class="login-modal" style="display: none;">
        <div class="login-form">
            <div class="login-title">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                <input type="password" id="currentPassword" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
            </div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                <input type="password" id="newPassword" class="form-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
            </div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</label>
                <input type="password" id="confirmPassword" class="form-input" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">
            </div>
            <div id="passwordChangeError" class="login-error" style="display: none;"></div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="changePassword()" class="btn-success flex-1">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                <button onclick="closeChangePasswordModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ© -->
    <div id="emergencyAlertModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 600px; max-width: 95vw; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation();">
            <div class="login-title">ğŸš¨ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ©</div>
            <div class="text-white/70 mb-6">Ø¥Ø¶Ø§ÙØ© ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</div>
            
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø±ÙŠØ· -->
            <div class="mb-6 p-4 bg-white/10 rounded-xl border border-white/20">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-white font-medium">Ø­Ø§Ù„Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:</span>
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <span id="alertStatusText" class="text-sm text-white/70">Ù…Ø®ÙÙŠ</span>
                        <div id="alertStatusIndicator" class="w-3 h-3 bg-gray-500 rounded-full"></div>
                    </div>
                </div>
                <button id="toggleAlertBtn" onclick="toggleEmergencyAlert()" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200">
                    ØªØ´ØºÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                </button>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ© -->
            <div class="mb-6">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-white font-medium">Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
                    <span id="eventsCount" class="text-white/70 text-sm">0 Ø­Ø¯Ø«</span>
                </div>
                <div id="eventsList" class="space-y-2 max-h-60 overflow-y-auto">
                    <div class="text-white/50 text-sm text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø«</div>
                </div>
            </div>

            <!-- Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯ -->
            <div class="mb-6 p-4 bg-white/5 rounded-xl border border-white/10">
                <h3 class="text-white font-medium mb-4">â• Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯</h3>
                
                <div class="mb-4">
                    <label class="block text-white font-medium text-sm mb-2">Ø±Ù…Ø² Ø§Ù„Ø­Ø¯Ø« (emoji):</label>
                    <input type="text" id="newEventIcon" class="form-input" placeholder="ğŸš¨" maxlength="5">
                    <p class="text-white/50 text-xs mt-1">Ù…Ø«Ø§Ù„: ğŸš¨ ğŸ”¥ âš¡ ğŸ¥ âš ï¸</p>
                </div>
                
                <div class="mb-4">
                    <label class="block text-white font-medium text-sm mb-2">ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«:</label>
                    <textarea id="newEventDescription" class="form-input" rows="3" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«..."></textarea>
                </div>

                <button onclick="addNewEvent()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200">
                    â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø«
                </button>
            </div>

            <div class="flex space-x-3 space-x-reverse">
                <button onclick="closeEmergencyAlertModal()" class="btn-secondary flex-1">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© (Ù…ØªØ²Ø§Ù…Ù†Ø©) -->
    <div id="editLifeSavingReferralsModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title">ğŸš¨ ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„Ø¹Ø¯Ø¯:</label>
                <input type="number" id="lifeSavingReferralsInput" class="form-input" min="0" placeholder="0">
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveLifeSavingReferrals()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeLifeSavingReferralsModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© (Ù…ØªØ²Ø§Ù…Ù†Ø©) -->
    <div id="editEmergencyReferralsModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title">ğŸš¨ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„Ø¹Ø¯Ø¯:</label>
                <input type="number" id="emergencyReferralsInput" class="form-input" min="0" placeholder="0">
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveEmergencyReferrals()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeEmergencyReferralsModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© (Ù…ØªØ²Ø§Ù…Ù†Ø©) -->
    <div id="editServicePurchaseModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 500px; max-width: 95vw;">
            <div class="login-title">ğŸ›ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø§Øª</div>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-white font-medium text-sm mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª:</label>
                    <input type="number" id="servicePurchaseTotalInput" class="form-input" min="0" placeholder="0">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">ØªÙ… Ø§Ù„Ù†Ù‚Ù„:</label>
                    <input type="number" id="servicePurchaseTransferredInput" class="form-input" min="0" placeholder="0">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">ØªÙ… Ø§Ù„Ø±ÙØ¶:</label>
                    <input type="number" id="servicePurchaseRejectedInput" class="form-input" min="0" placeholder="0">
                </div>
                <div>
                    <label class="block text-white font-medium text-sm mb-2">ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</label>
                    <input type="number" id="servicePurchaseUnderProcessInput" class="form-input" min="0" placeholder="0">
                </div>
                <div class="col-span-2">
                    <label class="block text-white font-medium text-sm mb-2">Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰:</label>
                    <input type="number" id="servicePurchaseOtherInput" class="form-input" min="0" placeholder="0">
                </div>
            </div>
            
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveServicePurchase()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeServicePurchaseModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Mobile Medical Team -->
    <div id="editMobileTeamModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 500px; max-width: 95vw;">
            <div class="login-title">ğŸš˜ Ø¥Ø¯Ø§Ø±Ø© ÙØ±Ù‚ Mobile Medical Team</div>
            <div class="text-white/70 mb-4">Ø£Ø¶Ù Ø£Ùˆ Ø§Ø­Ø°Ù Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…ØªÙ†Ù‚Ù„Ø©</div>
            
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</label>
                <input type="text" id="mobileTeamFacilityInput" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø£Ùˆ Ø§Ù„Ù…Ø±ÙƒØ²">
            </div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚:</label>
                <input type="number" id="mobileTeamTeamsInput" class="form-input" min="1" placeholder="0">
            </div>
            
            <button onclick="addMobileTeam()" class="btn-success w-full mb-4">Ø¥Ø¶Ø§ÙØ© ÙØ±ÙŠÙ‚</button>
            
            <div class="bg-gray-700/30 rounded-lg p-3 mb-4 max-h-64 overflow-y-auto">
                <div id="mobileTeamsListContainer">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
            
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="closeMobileTeamModal()" class="btn-secondary flex-1">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>


    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© -->
    <div id="editSideLifeSavingModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title">ğŸ”´ ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„Ø¹Ø¯Ø¯:</label>
                <input type="number" id="sideLifeSavingInput" class="form-input" min="0" placeholder="0">
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveSideLifeSavingCases()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeSideLifeSavingModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© -->
    <div id="editSideEmergencyModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title">ğŸŸ¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„Ø¹Ø¯Ø¯:</label>
                <input type="number" id="sideEmergencyInput" class="form-input" min="0" placeholder="0">
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveSideEmergencyCases()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeSideEmergencyModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø© -->
    <div id="editSideStableModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title">ğŸŸ¢ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</div>
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ù„Ø¹Ø¯Ø¯:</label>
                <input type="number" id="sideStableInput" class="form-input" min="0" placeholder="0">
            </div>
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveSideStableCases()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeSideStableModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>


    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© -->
    <div id="bedTypesManagerModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 400px; max-width: 95vw;">
            <div class="login-title" id="bedTypesManagerTitle">ğŸ¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
            <div class="text-white/70 mb-6">Ø§Ø®ØªØ± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
            
            <div id="bedTypesCheckboxes" class="space-y-3 mb-6">
                <!-- Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
            
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="closeBedTypesManager()" class="btn-success flex-1">ØªÙ… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>
                <button onclick="closeBedTypesManager()" class="btn-secondary flex-1">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>
        </div>
    </div>

    <!-- Ù†ÙˆØ§ÙØ° ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© -->
    <div id="editHospitalBedsModal" class="login-modal" style="display: none;">
        <div class="login-form" style="width: 500px; max-width: 95vw; max-height: 90vh; overflow-y: auto;">
            <div class="login-title">ğŸ­ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©</div>
            <div class="text-white/70 mb-6">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ ÙˆØ§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©</div>
            
            <div class="mb-4">
                <label class="block text-white font-medium text-sm mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰:</label>
                <input type="text" id="hospitalNameInput" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯">
            </div>
            
            <div class="bg-blue-500/10 rounded-xl p-4 mb-4 border border-blue-300/20">
                <h4 class="text-blue-200 font-bold text-lg mb-3">ER</h4>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©:</label>
                        <input type="number" id="emergencyOccupiedInput" class="form-input" min="0" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</label>
                        <input type="number" id="emergencyTotalInput" class="form-input" min="0" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="bg-purple-500/10 rounded-xl p-4 mb-4 border border-purple-300/20">
                <h4 class="text-purple-200 font-bold text-lg mb-3">ICU</h4>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©:</label>
                        <input type="number" id="icuOccupiedInput" class="form-input" min="0" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</label>
                        <input type="number" id="icuTotalInput" class="form-input" min="0" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="bg-pink-500/10 rounded-xl p-4 mb-6 border border-pink-300/20">
                <h4 class="text-pink-200 font-bold text-lg mb-3">CCU</h4>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©:</label>
                        <input type="number" id="ccuOccupiedInput" class="form-input" min="0" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</label>
                        <input type="number" id="ccuTotalInput" class="form-input" min="0" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 space-x-reverse">
                <button onclick="saveHospitalBeds()" class="btn-success flex-1">Ø­ÙØ¸</button>
                <button onclick="closeHospitalBedsModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´Ø£Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
    <div id="addFacilityModal" class="login-modal" style="display: none;" onclick="event.stopPropagation();">
        <div class="login-form" style="width: 600px; max-width: 95vw; max-height: 90vh; overflow-y: auto;" onclick="event.stopPropagation();">
            <div class="login-title">ğŸ¥ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´Ø£Ø© Ø¬Ø¯ÙŠØ¯Ø©</div>
            
            <div class="space-y-4">
                <!-- Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© -->
                <div>
                    <label class="block text-white text-base font-semibold mb-3 block">Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©</label>
                    <input type="text" id="facilityName" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ù…ÙŠØ± Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">
                </div>

                <!-- Ù„ÙˆÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
                <div>
                    <label class="block text-white text-base font-semibold mb-3 block">Ù„ÙˆÙ† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</label>
                    <select id="facilityColor" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white">
                        <option value="green">Ø£Ø®Ø¶Ø±</option>
                        <option value="orange">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                        <option value="teal">ØªØ±ÙƒÙˆØ§Ø²ÙŠ</option>
                        <option value="indigo">Ù†ÙŠÙ„ÙŠ</option>
                        <option value="red">Ø£Ø­Ù…Ø±</option>
                        <option value="yellow">Ø£ØµÙØ±</option>
                    </select>
                </div>

                <!-- Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø±Ø© -->
                <div class="space-y-4">
                    <p class="text-white/70 text-sm">ğŸ’¡ Ø£Ø¯Ø®Ù„ ÙÙ‚Ø· Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§ (Ø§ØªØ±Ùƒ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙØ§Ø±ØºØ© Ù„Ù„Ø£Ù†ÙˆØ§Ø¹ ØºÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ -->
                        <div>
                            <label class="block text-white text-base font-semibold mb-3 block">ER</label>
                            <div class="space-y-2">
                                <input type="number" id="facilityEmergencyOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                                <input type="number" id="facilityEmergencyTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                            </div>
                        </div>

                        <!-- Ø£Ø³Ø±Ø© ICU -->
                        <div>
                            <label class="block text-white text-base font-semibold mb-3 block">ICU</label>
                            <div class="space-y-2">
                                <input type="number" id="facilityIcuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                                <input type="number" id="facilityIcuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                            </div>
                        </div>

                        <!-- Ø£Ø³Ø±Ø© CCU -->
                        <div>
                            <label class="block text-white text-base font-semibold mb-3 block">CCU</label>
                            <div class="space-y-2">
                                <input type="number" id="facilityCcuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                                <input type="number" id="facilityCcuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                            </div>
                        </div>

                        <!-- Ø£Ø³Ø±Ø© PICU -->
                        <div>
                            <label class="block text-white text-base font-semibold mb-3 block">PICU</label>
                            <div class="space-y-2">
                                <input type="number" id="facilityPicuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                                <input type="number" id="facilityPicuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                            </div>
                        </div>

                        <!-- Ø£Ø³Ø±Ø© NICU -->
                        <div>
                            <label class="block text-white text-base font-semibold mb-3 block">NICU</label>
                            <div class="space-y-2">
                                <input type="number" id="facilityNicuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                                <input type="number" id="facilityNicuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50" placeholder="Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" min="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex space-x-3 space-x-reverse mt-6">
                <button onclick="saveFacility()" class="btn-success flex-1">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø©</button>
                <button onclick="closeFacilityModal()" class="btn-secondary flex-1">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    </div>
    <!-- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ù…ÙŠ -->

    

    
    <script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² - Ù…ØµÙÙˆÙØ© ÙØ§Ø±ØºØ© Ù„Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø§Ù„ØµÙØ±
        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        const MAIN_PASSWORD = "emergency2024"; // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        let isAuthenticated = false;

        // ÙØ­Øµ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function checkMainPassword() {
            const password = document.getElementById('mainProtectionPassword').value;
            const errorDiv = document.getElementById('mainProtectionError');
            
            if (password === MAIN_PASSWORD) {
                // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØµØ­ÙŠØ­Ø© - ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
                isAuthenticated = true;
                window.isAdminMode = true;
                document.getElementById('mainProtectionModal').style.display = 'none';
                document.getElementById('protectedContent').classList.remove('hidden');
                initializeDashboard();
            } else if (password === 'Moh@1410') {
                // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ÙÙ‚Ø·
                isAuthenticated = true;
                window.isAdminMode = false;
                document.getElementById('mainProtectionModal').style.display = 'none';
                document.getElementById('protectedContent').classList.remove('hidden');
                initializeDashboard();
            } else {
                // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©
                errorDiv.classList.remove('hidden');
                document.getElementById('mainProtectionPassword').value = '';
                
                // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
                setTimeout(() => {
                    errorDiv.classList.add('hidden');
                }, 3000);
            }
        }

        // Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('mainProtectionPassword');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkMainPassword();
                    }
                });
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase
        async function loadAllDataFromSupabase() {
            try {
                console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase...');
                
                // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const allData = await syncManager.loadAllData();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
                if (allData.emergencyCenters) {
                    emergencyCenters = allData.emergencyCenters;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ emergencyCenters:', emergencyCenters.length);
                }
                
                if (allData.customFacilities) {
                    customFacilities = allData.customFacilities;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ customFacilities:', customFacilities.length);
                }
                
                if (allData.servicePurchaseData) {
                    servicePurchaseData = allData.servicePurchaseData;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ servicePurchaseData');
                }
                
                if (allData.emergencyDashboardData) {
                    emergencyDashboardData = allData.emergencyDashboardData;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ emergencyDashboardData');
                }
                
                if (allData.referralsData) {
                    referralsData = allData.referralsData;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ referralsData');
                    updateReferralsDisplay();
                }
                
                if (allData.servicePurchaseData) {
                    servicePurchaseData = allData.servicePurchaseData;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ servicePurchaseData');
                    updateServicePurchaseDisplay();
                }
                
                if (allData.mobileTeams) {
                    mobileTeamData = allData.mobileTeams;
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ mobileTeams');
                    updateMobileTeamsDisplay();
                }
                
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase Ø¨Ù†Ø¬Ø§Ø­');
                return true;
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase:', error);
                return false;
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function initializeDashboard() {
            console.log('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯...');
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø²Ø± ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            const adminButton = document.getElementById('adminModeButton');
            if (adminButton) {
                if (window.isAdminMode) {
                    adminButton.style.display = 'block';
                } else {
                    adminButton.style.display = 'none';
                }
            }
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase Ø£ÙˆÙ„Ø§Ù‹
            loadAllDataFromSupabase().then(() => {
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase');
                loadReferralsData();
                loadMobileTeamsFromSupabase();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
                updateMainStats();
                loadServicePurchaseData();
                displayCenters();
                renderFacilitiesCards();
                renderCustomFacilities();
                updateTopActiveCenters();
                updateLastUpdateTime();
                
                // Ø¥Ø¶Ø§ÙØ© Realtime Listener Ù„Ù„ØªØ²Ø§Ù…Ù† Ø§Ù„ÙÙˆØ±ÙŠ
                setupRealtimeListeners();
            }).catch(error => {
                console.log('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† SupabaseØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©');
                const dataLoaded = loadDataFromStorage();
                loadReferralsData();
                loadMobileTeamsFromSupabase();
            });
            
            // Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ø¹ Supabase - Ù…Ø¹Ø·Ù„Ø© ØªÙ…Ø§Ù…Ø§Ù‹
            // Ù„Ø§ ØªØ³ØªØ¯Ø¹ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© - ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§ ÙÙ‚Ø·
            window.syncIntervalId = null;
            
            // Ø¯Ø§Ù„Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© (Ù…Ø¹Ø·Ù„Ø© ØªÙ…Ø§Ù…Ø§Ù‹ - Ù„Ø§ ØªÙØ³ØªØ®Ø¯Ù…)
            window.startSync = function() {
                console.log('âš ï¸ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù…Ø¹Ø·Ù„Ø© - ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§');
                // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¡
            };
            
            // Ø¯Ø§Ù„Ø© Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
            window.stopSync = function() {
                if (window.syncIntervalId) {
                    clearInterval(window.syncIntervalId);
                    window.syncIntervalId = null;
                    console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
                }
            };
            
            // Ù„Ø§ ØªØ³ØªØ¯Ø¹ÙŠ startSync - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹Ø·Ù„Ø© ØªÙ…Ø§Ù…Ø§Ù‹
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                document.getElementById('refreshInterval').value = '5000';
                setRefreshInterval();
            }, 1000);
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø¨ØµÙ…Øª)
            setInterval(() => {
                saveDataToStorage(true);
                console.log('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }, 60000);
            
            // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            if (dataLoaded) {
                console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                console.log('ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
                showNotification('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ', 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©', 'info');
            }
            
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ² (Ø¨ØµÙ…Øª)
            document.addEventListener('centerUpdated', function() {
                saveDataToStorage(true);
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ²');
            });
            
            console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­');
            
        }

        window.emergencyCenters = [];

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        window.window.isAdminMode = false;
        window.currentZoom = 100;
        window.refreshInterval = null;
        window.globalResponseTime = 0.0;


        // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ ÙˆÙÙˆØ±ÙŠ
        function forceUpdateAllCards() {
            console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­...');
            
            try {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

                // ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ updateMainStats
                if (emergencyCenters && emergencyCenters.length > 0) {
                    console.log('ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª emergencyCenters Ù…ÙˆØ¬ÙˆØ¯Ø©:', emergencyCenters.length, 'Ù…Ø±Ø§ÙƒØ²');
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ø§Ù…ÙŠØ¹ Ù…Ø¨Ø§Ø´Ø±Ø©
                    const totalStaff = emergencyCenters.reduce((sum, c) => sum + c.totalStaff, 0);
                    const currentStaff = emergencyCenters.reduce((sum, c) => sum + c.currentStaff, 0);
                    const lifeSavingCases = emergencyCenters.reduce((sum, c) => sum + c.lifeSavingCases, 0);
                    const moderateCases = emergencyCenters.reduce((sum, c) => sum + c.moderateCases, 0);
                    const stableCases = emergencyCenters.reduce((sum, c) => sum + c.stableCases, 0);
                    const homeCases = emergencyCenters.reduce((sum, c) => sum + c.homeCases, 0);
                    const healthCenterCases = emergencyCenters.reduce((sum, c) => sum + c.healthCenterCases, 0);
                    const totalAmbulances = emergencyCenters.reduce((sum, c) => sum + c.totalAmbulances, 0);
                    const activeAmbulances = emergencyCenters.reduce((sum, c) => sum + c.activeAmbulances, 0);
                    const outOfService = emergencyCenters.reduce((sum, c) => sum + (c.inactiveAmbulances || 0), 0);
                    
                    // ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ø¹Ù†Ø§ØµØ±
                    const updates = {
                        'currentStaff': currentStaff,

                        'vehicleStatus': activeAmbulances,
                        'totalAmbulances': totalAmbulances,
                        'outOfServiceTotal': outOfService
                    };
                    
                    for (const [id, value] of Object.entries(updates)) {
                        const el = document.getElementById(id);
                        if (el) {
                            el.textContent = value;
                            console.log(`âœ… ØªØ­Ø¯ÙŠØ« Ù…Ø¨Ø§Ø´Ø±: ${id} = ${value}`);
                        }
                    }
                } else {
                    console.warn('âš ï¸ emergencyCenters ÙØ§Ø±ØºØ© Ø£Ùˆ undefined');
                }
                updateMainStats();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©');
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²
                displayCenters();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
                renderCustomFacilities();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù†Ø´Ø·Ø©
                updateTopActiveCenters();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ù†Ø´Ø·Ø©');
                
                // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                updateCaseDistributionChart();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
                updateLastUpdateTime();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª:', error);
            }
        }
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function updateMainStats() {
            console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ updateMainStats...');
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… emergencyCenters Ø§Ù„Ø­Ø§Ù„ÙŠ (ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù…Ù† loadAllDataFromSupabase)
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ø¯Ø«Ø©
            const centersData = (typeof emergencyCenters !== 'undefined' && emergencyCenters && emergencyCenters.length > 0) ? emergencyCenters : [];
            console.log('ğŸ“„ emergencyCenters.length:', centersData.length);
            
            const totalStaff = centersData.reduce((sum, center) => sum + center.totalStaff, 0);
            const currentStaff = centersData.reduce((sum, center) => sum + center.currentStaff, 0);
            const totalAmbulances = centersData.reduce((sum, center) => sum + center.totalAmbulances, 0);
            const activeAmbulances = centersData.reduce((sum, center) => sum + center.activeAmbulances, 0);
            const healthCenterCases = centersData.reduce((sum, center) => sum + center.healthCenterCases, 0);
            const homeCases = centersData.reduce((sum, center) => sum + center.homeCases, 0);
            const lifeSavingCases = centersData.reduce((sum, center) => sum + center.lifeSavingCases, 0);
            const moderateCases = centersData.reduce((sum, center) => sum + center.moderateCases, 0);
            const stableCases = centersData.reduce((sum, center) => sum + center.stableCases, 0);
            const outOfService = centersData.reduce((sum, center) => sum + (center.inactiveAmbulances || 0), 0);
            const totalCenters = centersData.length;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ±Ù‚: ÙƒÙ„ Ø´Ø®ØµÙŠÙ† = ÙØ±Ù‚Ø© ÙˆØ§Ø­Ø¯Ø©
            const totalTeams = Math.floor(currentStaff / 2);
            
            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª
            const totalCases = lifeSavingCases + moderateCases + stableCases + homeCases + healthCenterCases;


            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¨Ø£Ù…Ø§Ù† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… IDs Ù…Ø­Ø¯Ø¯Ø©
            try {
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¨Ø¯Ù‚Ø©
                const elements = {

                    // Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© (Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'lifeSavingCasesTotal': lifeSavingCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© (Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'emergencyCasesTotal': moderateCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø© (Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'stableCasesTotal': stableCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø© (Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'moderateCasesTotal': moderateCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ© (Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'homeCasesTotal': homeCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ© (Ù…Ù† Ø§Ù„Ù…Ø±Ø§ÙƒØ²)
                    'healthCenterCasesTotal': healthCenterCases,
                    
                    // Ø¨Ø·Ø§Ù‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
                    'responseTime': globalResponseTime.toFixed(1),
                    'totalActiveCenters': totalCenters,
                    'availableTeams': totalTeams,
                    'quickStats': totalCases,
                    'vehicleStatus': activeAmbulances,
                    'totalAmbulances': totalAmbulances,
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©
                    'outOfServiceTotal': outOfService
                };
                
                for (const [id, value] of Object.entries(elements)) {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                        console.log(`âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ${id} = ${value}`);
                    } else {
                        console.warn(`âš ï¸ Ø¹Ù†ØµØ± ${id} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`);
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†Ø§ØµØ±:', error);
            }
            
            // Ø¨Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø¹Ø¨Ø± BroadcastChannel
            try {
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('emergency_dashboard_updates');
                    channel.postMessage({
                        type: 'stats_updated',
                        timestamp: Date.now()
                    });
                    setTimeout(() => channel.close(), 100);
                    console.log('ğŸ“¡ ØªÙ… Ø¨Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ø¨Ø± BroadcastChannel');
                }
            } catch (error) {
                console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø¨Ø« BroadcastChannel:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§ÙƒØ²
        function displayCenters() {
            const grid = document.getElementById('centersGrid');
            grid.innerHTML = '';

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø±Ø§ÙƒØ²
            if (emergencyCenters.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full">
                        <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-12 border border-purple-300/20 card-hover text-center">
                            <div class="text-6xl mb-4">ğŸ¥</div>
                            <h2 class="text-2xl font-bold text-white mb-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠØ© Ù…Ø¶Ø§ÙØ©</h2>
                            <p class="text-white/70 mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ Ø¬Ø¯ÙŠØ¯ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                            ${isAdminMode ? `
                            <button onclick="showAddCenterModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-medium transition-all duration-200 flex items-center space-x-2 space-x-reverse mx-auto">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                <span>Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ</span>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§ÙƒØ²
            const tableCard = `
                <div class="col-span-full">
                    <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-purple-300/20 card-hover">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold text-white flex items-center">
                                ğŸ¥ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§ÙÙŠØ©
                            </h2>
                            <div class="text-white/70 text-sm">
                                Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø§ÙƒØ²: <span class="text-white font-bold">${emergencyCenters.length}</span>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-white">
                                <thead>
                                    <tr class="border-b border-white/20">
                                        <th class="text-right py-3 px-4 font-bold text-white/90">Ø§Ù„Ù…Ø±ÙƒØ²</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">ğŸ”´ Ø¥Ù†Ù‚Ø§Ø° Ø­ÙŠØ§Ø©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">ğŸŸ  Ù…ØªÙˆØ³Ø·Ø©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">ğŸŸ¢ Ù…Ø³ØªÙ‚Ø±Ø©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">ğŸ”µ Ù…Ù†Ø²Ù„ÙŠØ©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©</th>
                                        <th class="text-center py-3 px-2 font-bold text-white/90">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        ${isAdminMode ? '<th class="text-center py-3 px-2 font-bold text-white/90">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>' : ''}
                                    </tr>
                                </thead>
                                <tbody>
            `;

            // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ (Ø£Ø®Ø¶Ø± = Ù…Ù…ØªØ§Ø²ØŒ Ø£Ø­Ù…Ø± = Ø­Ø±Ø¬)
            const getResourceColor = (percent) => {
                if (percent >= 75) return '#10b981'; // Ø£Ø®Ø¶Ø± - Ù…Ù…ØªØ§Ø²
                if (percent >= 50) return '#f97316'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ - ØªØ­Ø°ÙŠØ±
                return '#ef4444'; // Ø£Ø­Ù…Ø± - Ø­Ø±Ø¬
            };

            let tableRows = '';
            emergencyCenters.forEach((center, index) => {
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² 100%
                const staffPercentage = center.totalStaff > 0 ? Math.min(100, Math.round((center.currentStaff / center.totalStaff) * 100)) : 0;
                const ambulancePercentage = center.totalAmbulances > 0 ? Math.min(100, Math.round((center.activeAmbulances / center.totalAmbulances) * 100)) : 0;
                const staffColor = getResourceColor(staffPercentage);
                const ambulanceColor = getResourceColor(ambulancePercentage);
                
                tableRows += `
                    <tr class="border-b border-white/10 hover:bg-white/5 transition-colors duration-200">
                        <td class="py-4 px-4">
                            <div class="text-right">
                                <div class="font-bold text-white text-lg">${center.name}</div>
                                <div class="text-white/70 text-sm">ğŸ“ ${center.location}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="flex flex-col items-center">
                                <div class="text-white font-bold text-lg">${center.currentStaff}/${center.totalStaff}</div>
                                <div class="w-12 h-2 bg-white/20 rounded-full mt-1">
                                    <div class="h-2 rounded-full transition-all duration-500" style="width: ${staffPercentage}%; background: ${staffColor}"></div>
                                </div>
                                <div class="text-xs mt-1" style="color: ${staffColor}">${staffPercentage}%</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="flex flex-col items-center">
                                <div class="text-white font-bold text-lg">${center.activeAmbulances}/${center.totalAmbulances}</div>
                                <div class="w-12 h-2 bg-white/20 rounded-full mt-1">
                                    <div class="h-2 rounded-full transition-all duration-500" style="width: ${ambulancePercentage}%; background: ${ambulanceColor}"></div>
                                </div>
                                <div class="text-xs mt-1" style="color: ${ambulanceColor}">${ambulancePercentage}%</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="text-white font-bold text-lg">${center.responseTime}</div>
                            <div class="text-yellow-300 text-xs">Ø¯Ù‚ÙŠÙ‚Ø©</div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="bg-red-600/30 rounded-lg p-2 border border-red-400/30">
                                <div class="text-white font-bold text-lg">${center.lifeSavingCases}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="bg-orange-600/30 rounded-lg p-2 border border-orange-400/30">
                                <div class="text-white font-bold text-lg">${center.moderateCases}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="bg-green-600/30 rounded-lg p-2 border border-green-400/30">
                                <div class="text-white font-bold text-lg">${center.stableCases}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="bg-blue-600/30 rounded-lg p-2 border border-blue-400/30">
                                <div class="text-white font-bold text-lg">${center.homeCases}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="bg-teal-600/30 rounded-lg p-2 border border-teal-400/30">
                                <div class="text-white font-bold text-lg">${center.healthCenterCases}</div>
                            </div>
                        </td>
                        <td class="py-4 px-2 text-center">
                            <div class="flex items-center justify-center space-x-2 space-x-reverse">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-green-300 text-sm font-medium">${center.status}</span>
                            </div>
                        </td>
                        ${isAdminMode ? `
                        <td class="py-4 px-2 text-center">
                            <div class="flex justify-center space-x-2 space-x-reverse">
                                <button onclick="editCenter(${center.id})" class="bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-lg text-sm transition-colors">
                                    âœï¸
                                </button>
                                <button onclick="deleteCenter(${center.id})" class="bg-red-600 hover:bg-red-700 text-white p-2 rounded-lg text-sm transition-colors">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </td>
                        ` : ''}
                    </tr>
                `;
            });

            const tableFooter = `
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Ù…Ù„Ø®Øµ Ø¥Ø¬Ù…Ø§Ù„ÙŠ -->
                        <div class="mt-6 pt-4 border-t border-white/20">
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <div class="bg-purple-600/20 rounded-lg p-3 text-center">
                                    <div class="text-purple-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                                    <div class="text-white font-bold text-xl">${emergencyCenters.reduce((sum, center) => sum + center.currentStaff, 0)}/${emergencyCenters.reduce((sum, center) => sum + center.totalStaff, 0)}</div>
                                </div>
                                <div class="bg-green-600/20 rounded-lg p-3 text-center">
                                    <div class="text-green-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª</div>
                                    <div class="text-white font-bold text-xl">${emergencyCenters.reduce((sum, center) => sum + center.activeAmbulances, 0)}/${emergencyCenters.reduce((sum, center) => sum + center.totalAmbulances, 0)}</div>
                                </div>
                                <div class="bg-red-600/20 rounded-lg p-3 text-center">
                                    <div class="text-red-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</div>
                                    <div class="text-white font-bold text-xl">${emergencyCenters.reduce((sum, center) => sum + center.lifeSavingCases, 0)}</div>
                                </div>
                                <div class="bg-yellow-600/20 rounded-lg p-3 text-center">
                                    <div class="text-yellow-200 text-sm">Ù…ØªÙˆØ³Ø· Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
                                    <div class="text-white font-bold text-xl">${emergencyCenters.length > 0 ? (emergencyCenters.reduce((sum, center) => sum + center.responseTime, 0) / emergencyCenters.length).toFixed(1) : '0.0'} Ø¯Ù‚ÙŠÙ‚Ø©</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ø£Ø³ÙÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
                        <div class="mt-8 text-center text-white/60 text-xs no-print">
                            <div class="bg-white/5 backdrop-blur-lg rounded-lg p-3 border border-white/10">
                                <p class="font-medium text-white/80">ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«</p>
                                <p class="text-white/40 mt-1">ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</p>
                                <p class="text-white/40 mt-1">ØªØµÙ…ÙŠÙ… Hafalobaidi | Ø§Ù„Ù†Ø³Ø®Ø© 6.0.0</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            grid.innerHTML = tableCard + tableRows + tableFooter;
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª
            updateCaseDistributionChart();
            

        }
        
        // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø¢Ø§Øª Ø§Ù„ØµØ­ÙŠØ©
        function renderFacilitiesCards() {
            const container = document.getElementById('facilitiesCardsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù†Ø´Ø¢Ø§Øª
            if (!customFacilities || customFacilities.length === 0) {
                return;
            }
            
            // Ø¹Ø±Ø¶ ÙƒÙ„ Ù…Ù†Ø´Ø£Ø© ÙƒØ¨Ø·Ø§Ù‚Ø©
            customFacilities.forEach(facility => {
                // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø³Ø±Ø© ÙˆØ§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„ÙƒÙ„ Ù†ÙˆØ¹
                const getBedCount = (bedType) => {
                    if (!facility[bedType]) return { occupied: 0, total: 0 };
                    return {
                        occupied: facility[bedType].occupied || 0,
                        total: facility[bedType].total || 0
                    };
                };
                
                const er = getBedCount('emergency');
                const icu = getBedCount('icu');
                const ccu = getBedCount('ccu');
                const picu = getBedCount('picu');
                const nicu = getBedCount('nicu');
                
                const totalBeds = er.total + icu.total + ccu.total + picu.total + nicu.total;
                const occupiedBeds = er.occupied + icu.occupied + ccu.occupied + picu.occupied + nicu.occupied;
                const occupancyPercent = totalBeds > 0 ? Math.round((occupiedBeds / totalBeds) * 100) : 0;
                const occupancyColor = occupancyPercent >= 75 ? '#ef4444' : occupancyPercent >= 50 ? '#f97316' : '#10b981';
                
                // Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
                const getPercentColor = (percent) => {
                    if (percent >= 75) return '#ef4444'; // Ø£Ø­Ù…Ø±
                    if (percent >= 50) return '#f97316'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
                    return '#10b981'; // Ø£Ø®Ø¶Ø±
                };
                
                // Ø¨Ù†Ø§Ø¡ HTML ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø³Ø±Ø©
                let bedsDetailsHTML = '';
                
                if (er.total > 0) {
                    const erPercent = Math.round((er.occupied / er.total) * 100);
                    bedsDetailsHTML += `<div class="text-xs mb-1 pb-1 border-b border-indigo-300/20">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200">ER</span>
                            <span style="color: ${getPercentColor(erPercent)}">${erPercent}%</span>
                        </div>
                        <div class="text-indigo-300 text-xs">${er.occupied}/${er.total}</div>
                    </div>`;
                }
                
                if (icu.total > 0) {
                    const icuPercent = Math.round((icu.occupied / icu.total) * 100);
                    bedsDetailsHTML += `<div class="text-xs mb-1 pb-1 border-b border-indigo-300/20">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200">ICU</span>
                            <span style="color: ${getPercentColor(icuPercent)}">${icuPercent}%</span>
                        </div>
                        <div class="text-indigo-300 text-xs">${icu.occupied}/${icu.total}</div>
                    </div>`;
                }
                
                if (ccu.total > 0) {
                    const ccuPercent = Math.round((ccu.occupied / ccu.total) * 100);
                    bedsDetailsHTML += `<div class="text-xs mb-1 pb-1 border-b border-indigo-300/20">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200">CCU</span>
                            <span style="color: ${getPercentColor(ccuPercent)}">${ccuPercent}%</span>
                        </div>
                        <div class="text-indigo-300 text-xs">${ccu.occupied}/${ccu.total}</div>
                    </div>`;
                }
                
                if (picu.total > 0) {
                    const picuPercent = Math.round((picu.occupied / picu.total) * 100);
                    bedsDetailsHTML += `<div class="text-xs mb-1 pb-1 border-b border-indigo-300/20">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200">PICU</span>
                            <span style="color: ${getPercentColor(picuPercent)}">${picuPercent}%</span>
                        </div>
                        <div class="text-indigo-300 text-xs">${picu.occupied}/${picu.total}</div>
                    </div>`;
                }
                
                if (nicu.total > 0) {
                    const nicuPercent = Math.round((nicu.occupied / nicu.total) * 100);
                    bedsDetailsHTML += `<div class="text-xs">
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200">NICU</span>
                            <span style="color: ${getPercentColor(nicuPercent)}">${nicuPercent}%</span>
                        </div>
                        <div class="text-indigo-300 text-xs">${nicu.occupied}/${nicu.total}</div>
                    </div>`;
                }
                
                // Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)
                const editButtonHTML = isAdminMode ? `<button onclick="event.stopPropagation(); editFacilityBeds(${facility.id})" class="text-blue-400 hover:text-blue-300 text-sm ml-2">âœï¸</button>` : '';
                
                const card = document.createElement('div');
                card.className = 'flex-shrink-0 bg-gradient-to-br from-indigo-500/20 to-indigo-600/10 backdrop-blur-lg rounded-2xl p-4 border border-indigo-300/20 card-hover min-w-max';
                card.style.width = '320px';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-indigo-200 text-sm font-medium">${facility.name}</p>
                            <p class="text-2xl font-bold text-white">${occupiedBeds}/${totalBeds}</p>
                            <p class="text-indigo-300 text-xs">Ø³Ø±ÙŠØ±</p>
                        </div>
                        <div class="flex items-center">
                            ${editButtonHTML}
                            <div class="professional-icon" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(79, 70, 229, 0.2)); color: #6366f1;">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                                    <path d="M12 8v4"/>
                                    <path d="M10 10h4"/>
                                    <circle cx="12" cy="6" r="1.5" fill="currentColor" opacity="0.6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="w-full h-2 bg-white/20 rounded-full mb-3">
                        <div class="h-2 rounded-full transition-all duration-500" style="width: ${occupancyPercent}%; background: ${occupancyColor}"></div>
                    </div>
                    <div class="text-xs mb-2" style="color: ${occupancyColor}">${occupancyPercent}% Ø¥Ø´ØºØ§Ù„</div>
                    <div class="bg-indigo-900/30 rounded-lg p-2">
                        ${bedsDetailsHTML}
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª
        function updateCaseDistributionChart() {
            const totalLifeSaving = emergencyCenters.reduce((sum, center) => sum + center.lifeSavingCases, 0);
            const totalModerate = emergencyCenters.reduce((sum, center) => sum + center.moderateCases, 0);
            const totalStable = emergencyCenters.reduce((sum, center) => sum + center.stableCases, 0);
            const totalHome = emergencyCenters.reduce((sum, center) => sum + center.homeCases, 0);
            const totalHealthCenter = emergencyCenters.reduce((sum, center) => sum + center.healthCenterCases, 0);
            
            const totalCases = totalLifeSaving + totalModerate + totalStable + totalHome + totalHealthCenter;
            
            if (totalCases === 0) return;
            
            const lifeSavingPercent = Math.round((totalLifeSaving / totalCases) * 100);
            const moderatePercent = Math.round((totalModerate / totalCases) * 100);
            const stablePercent = Math.round((totalStable / totalCases) * 100);
            const homePercent = Math.round((totalHome / totalCases) * 100);
            const healthCenterPercent = Math.round((totalHealthCenter / totalCases) * 100);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            const chart = document.getElementById('caseDistributionChart');
            if (!chart) return; // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ØµØ±
            
            const circumference = 100;
            let offset = 0;
            
            chart.innerHTML = '';
            
            // Ø¥Ù†Ù‚Ø§Ø° Ø­ÙŠØ§Ø© (Ø£Ø­Ù…Ø±)
            if (lifeSavingPercent > 0) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#ef4444');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('stroke-dasharray', `${lifeSavingPercent}, ${circumference}`);
                path.setAttribute('stroke-dashoffset', `-${offset}`);
                chart.appendChild(path);
                offset += lifeSavingPercent;
            }
            
            // Ù…ØªÙˆØ³Ø·Ø© (Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)
            if (moderatePercent > 0) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#f97316');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('stroke-dasharray', `${moderatePercent}, ${circumference}`);
                path.setAttribute('stroke-dashoffset', `-${offset}`);
                chart.appendChild(path);
                offset += moderatePercent;
            }
            
            // Ù…Ø³ØªÙ‚Ø±Ø© (Ø£Ø®Ø¶Ø±)
            if (stablePercent > 0) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#22c55e');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('stroke-dasharray', `${stablePercent}, ${circumference}`);
                path.setAttribute('stroke-dashoffset', `-${offset}`);
                chart.appendChild(path);
                offset += stablePercent;
            }
            
            // Ù…Ù†Ø²Ù„ÙŠØ© (Ø£Ø²Ø±Ù‚)
            if (homePercent > 0) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#3b82f6');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('stroke-dasharray', `${homePercent}, ${circumference}`);
                path.setAttribute('stroke-dashoffset', `-${offset}`);
                chart.appendChild(path);
                offset += homePercent;
            }
            
            // Ù…Ø±Ø§ÙƒØ² ØµØ­ÙŠØ© (Ù†ÙŠÙ„ÙŠ)
            if (healthCenterPercent > 0) {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', 'M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831');
                path.setAttribute('fill', 'none');
                path.setAttribute('stroke', '#6366f1');
                path.setAttribute('stroke-width', '3');
                path.setAttribute('stroke-dasharray', `${healthCenterPercent}, ${circumference}`);
                path.setAttribute('stroke-dashoffset', `-${offset}`);
                chart.appendChild(path);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            const legend = document.getElementById('caseDistributionLegend');
            if (!legend) return; // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¹Ù†ØµØ±
            
            legend.innerHTML = `
                ${lifeSavingPercent > 0 ? `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                        <span class="text-white">Ø¥Ù†Ù‚Ø§Ø° Ø­ÙŠØ§Ø©</span>
                    </div>
                    <span class="text-white font-bold">${lifeSavingPercent}% (${totalLifeSaving})</span>
                </div>` : ''}
                ${moderatePercent > 0 ? `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                        <span class="text-white">Ù…ØªÙˆØ³Ø·Ø©</span>
                    </div>
                    <span class="text-white font-bold">${moderatePercent}% (${totalModerate})</span>
                </div>` : ''}
                ${stablePercent > 0 ? `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-white">Ù…Ø³ØªÙ‚Ø±Ø©</span>
                    </div>
                    <span class="text-white font-bold">${stablePercent}% (${totalStable})</span>
                </div>` : ''}
                ${homePercent > 0 ? `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                        <span class="text-white">Ù…Ù†Ø²Ù„ÙŠØ©</span>
                    </div>
                    <span class="text-white font-bold">${homePercent}% (${totalHome})</span>
                </div>` : ''}
                ${healthCenterPercent > 0 ? `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-indigo-500 rounded-full mr-2"></div>
                        <span class="text-white">Ù…Ø±Ø§ÙƒØ² ØµØ­ÙŠØ©</span>
                    </div>
                    <span class="text-white font-bold">${healthCenterPercent}% (${totalHealthCenter})</span>
                </div>` : ''}
                <div class="mt-3 pt-2 border-t border-white/20">
                    <div class="flex items-center justify-between">
                        <span class="text-white/70">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª</span>
                        <span class="text-white font-bold">${totalCases}</span>
                    </div>
                </div>
            `;
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
        window.showViewMode = function() {
            window.isAdminMode = false;
            document.getElementById('adminControls').style.display = 'none';
            document.getElementById('printButton').classList.remove('admin-mode');
            updateMainStats();
            displayCenters();
        }

        window.showAdminMode = function() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        window.attemptLogin = function() {
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === 'admin123') {
                window.isAdminMode = true;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                document.getElementById('printButton').classList.add('admin-mode');
                document.getElementById('loginPassword').value = '';
                errorDiv.style.display = 'none';
                updateMainStats();
                displayCenters();
            } else {
                errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©';
                errorDiv.style.display = 'block';
            }
        }

        window.cancelLogin = function() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginError').style.display = 'none';
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±Ø§ÙƒØ²
        window.showAddCenterModal = function() {
            document.getElementById('addCenterModal').style.display = 'flex';
        }

        window.closeAddCenterModal = function() {
            document.getElementById('addCenterModal').style.display = 'none';
            clearAddCenterForm();
        }

        function clearAddCenterForm() {
            const inputs = ['centerName', 'centerLocation', 'totalStaffInput', 'currentStaffInput', 
                          'totalAmbulancesInput', 'activeAmbulancesInput', 'inactiveAmbulancesInput', 
                          'supportAmbulancesInput', 'lifeSavingCasesInput', 'homeCasesInput', 
                          'moderateCasesInput', 'stableCasesInput', 'responseTimeInput', 'healthCenterCasesInput'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = '';
                    element.placeholder = element.placeholder; // Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù€ placeholder
                }
            });
        }

        function addCenter() {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¬Ø¯ÙŠØ¯...');
            
            try {
                // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                const name = document.getElementById('centerName').value.trim();
                const location = document.getElementById('centerLocation').value.trim();
                
                console.log('ğŸ“ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø©:', { name, location });
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                if (!name || !location) {
                    alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ² ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                    return;
                }

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¬Ø¯ÙŠØ¯
                const totalStaff = parseInt(document.getElementById('totalStaffInput').value) || 0;
                const currentStaff = parseInt(document.getElementById('currentStaffInput').value) || 0;
                const totalAmbulances = parseInt(document.getElementById('totalAmbulancesInput').value) || 0;
                const activeAmbulances = parseInt(document.getElementById('activeAmbulancesInput').value) || 0;
                const inactiveAmbulances = parseInt(document.getElementById('inactiveAmbulancesInput').value) || 0;
                const supportAmbulances = parseInt(document.getElementById('supportAmbulancesInput').value) || 0;
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                if (currentStaff > totalStaff) {
                    alert('âŒ Ø®Ø·Ø£: Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ØªÙˆÙØ±ÙŠÙ† (' + currentStaff + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalStaff + ')');
                    return;
                }
                
                if (activeAmbulances > totalAmbulances) {
                    alert('âŒ Ø®Ø·Ø£: Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø© (' + activeAmbulances + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalAmbulances + ')');
                    return;
                }
                
                if ((inactiveAmbulances + supportAmbulances + activeAmbulances) > totalAmbulances) {
                    alert('âŒ Ø®Ø·Ø£: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª (' + (inactiveAmbulances + supportAmbulances + activeAmbulances) + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalAmbulances + ')');
                    return;
                }
                
                const newCenter = {
                    id: Date.now(), // Ø§Ø³ØªØ®Ø¯Ø§Ù… timestamp ÙƒÙ€ ID ÙØ±ÙŠØ¯
                    name: name,
                    location: location,
                    totalStaff: totalStaff,
                    currentStaff: currentStaff,
                    totalAmbulances: totalAmbulances,
                    activeAmbulances: activeAmbulances,
                    inactiveAmbulances: inactiveAmbulances,
                    supportAmbulances: supportAmbulances,
                    lifeSavingCases: parseInt(document.getElementById('lifeSavingCasesInput').value) || 0,
                    homeCases: parseInt(document.getElementById('homeCasesInput').value) || 0,
                    moderateCases: parseInt(document.getElementById('moderateCasesInput').value) || 0,
                    stableCases: parseInt(document.getElementById('stableCasesInput').value) || 0,
                    responseTime: parseFloat(document.getElementById('responseTimeInput').value) || 0,
                    healthCenterCases: parseInt(document.getElementById('healthCenterCasesInput').value) || 0,
                    status: "Ù†Ø´Ø·"
                };

                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø±ÙƒØ²:', newCenter);

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ² Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                window.emergencyCenters.push(newCenter);
                console.log('ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø­Ø§Ù„ÙŠ:', emergencyCente                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø£Ù…Ø§Ù†
                try {
                    displayCenters();
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø§ÙƒØ²');
                } catch (error) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶:', error);
                }

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ©
                try {
                    updateMainStats();
                    console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ©');
                } catch (error) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª:', error);
                }

                closeAddCenterModal();
                showNotification('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ù†Ø¬Ø§Ø­', 'success');              console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
                } catch (error) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
                }

                // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
                closeAddCenterModal();
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Supabase
                syncManager.saveData('emergencyCenters', emergencyCenters).then(() => {
                    
                    // Ø¨Ø« Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ÙˆØ§ÙØ°
                    if (typeof BroadcastChannel !== 'undefined') {
                        const channel = new BroadcastChannel('emergency_dashboard_updates');
                        channel.postMessage({
                            type: 'centers_updated',
                            timestamp: Date.now(),
                            data: 'Ù…Ø±Ø§ÙƒØ² Ù…Ø­Ø¯Ø«Ø©'
                        });
                        console.log('ğŸ“¢ ØªÙ… Ø¨Ø« Ø±Ø³Ø§Ù„Ø© centers_updated');
                        // ØªØ£Ø®ÙŠØ± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                        setTimeout(() => {
                            channel.close();
                            console.log('âœ… ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù‚Ù†Ø§Ø© BroadcastChannel');
                        }, 500);
                    }
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Supabase');
                }).catch(error => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                });
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                try {
                    saveDataToStorage();
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                } catch (error) {
                    console.warn('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                }
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                alert('ğŸ‰ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§ÙÙŠ Ø¨Ù†Ø¬Ø§Ø­!');
                console.log('ğŸ‰ ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ²:', error);
                alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ²: ' + error.message);
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
        function showQuickEditModal() {
            const content = document.getElementById('quickEditContent');
            content.innerHTML = '';

            emergencyCenters.forEach(center => {
                content.innerHTML += `
                    <div class="bg-white/5 rounded-lg p-4 mb-4">
                        <h4 class="text-white font-bold mb-3">${center.name}</h4>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                                <input type="number" id="edit_currentStaff_${center.id}" class="form-input text-sm" value="${center.currentStaff}">
                            </div>
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</label>
                                <input type="number" id="edit_activeAmbulances_${center.id}" class="form-input text-sm" value="${center.activeAmbulances}">
                            </div>
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©</label>
                                <input type="number" id="edit_healthCenterCases_${center.id}" class="form-input text-sm" value="${center.healthCenterCases}">
                            </div>
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©</label>
                                <input type="number" id="edit_lifeSavingCases_${center.id}" class="form-input text-sm" value="${center.lifeSavingCases}">
                            </div>
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</label>
                                <input type="number" id="edit_moderateCases_${center.id}" class="form-input text-sm" value="${center.moderateCases}">
                            </div>
                            <div>
                                <label class="block text-white/70 text-xs mb-1">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</label>
                                <input type="number" id="edit_stableCases_${center.id}" class="form-input text-sm" value="${center.stableCases}">
                            </div>
                        </div>
                    </div>
                `;
            });

            document.getElementById('quickEditModal').style.display = 'flex';
        }

        function closeQuickEditModal() {
            document.getElementById('quickEditModal').style.display = 'none';
        }

        function saveQuickEdit() {
            emergencyCenters.forEach(center => {
                const currentStaff = document.getElementById(`edit_currentStaff_${center.id}`);
                const activeAmbulances = document.getElementById(`edit_activeAmbulances_${center.id}`);
                const healthCenterCases = document.getElementById(`edit_healthCenterCases_${center.id}`);
                const lifeSavingCases = document.getElementById(`edit_lifeSavingCases_${center.id}`);
                const moderateCases = document.getElementById(`edit_moderateCases_${center.id}`);
                const stableCases = document.getElementById(`edit_stableCases_${center.id}`);

                if (currentStaff) center.currentStaff = parseInt(currentStaff.value) || 0;
                if (activeAmbulances) center.activeAmbulances = parseInt(activeAmbulances.value) || 0;
                if (healthCenterCases) center.healthCenterCases = parseInt(healthCenterCases.value) || 0;
                if (lifeSavingCases) center.lifeSavingCases = parseInt(lifeSavingCases.value) || 0;
                if (moderateCases) center.moderateCases = parseInt(moderateCases.value) || 0;
                if (stableCases) center.stableCases = parseInt(stableCases.value) || 0;
            });

            updateMainStats();
            displayCenters();
            closeQuickEditModal();
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹
            saveDataToStorage();
            showNotification('ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ø¯ÙŠÙ„ Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
        function showResponseTimeEditModal() {
            document.getElementById('globalResponseTimeInput').value = globalResponseTime;
            document.getElementById('responseTimeModal').style.display = 'flex';
        }

        function closeResponseTimeModal() {
            document.getElementById('responseTimeModal').style.display = 'none';
        }

        function updateGlobalResponseTime() {
            const newTime = parseFloat(document.getElementById('globalResponseTimeInput').value);
            if (newTime && newTime > 0) {
                globalResponseTime = newTime;
                document.getElementById('responseTime').textContent = globalResponseTime.toFixed(1);
                closeResponseTimeModal();
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹
                saveDataToStorage();
                showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø¥Ù„Ù‰ ${globalResponseTime.toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©`, 'success');
            } else {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø© Ù„Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©', 'error');
            }
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØµØ¯ÙŠØ±
        function showExportModal() {
            document.getElementById('exportModal').style.display = 'flex';
        }

        function closeExportModal() {
            document.getElementById('exportModal').style.display = 'none';
        }

        function exportToExcel() {
            const data = emergencyCenters.map(center => ({
                'Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ²': center.name,
                'Ø§Ù„Ù…ÙˆÙ‚Ø¹': center.location,
                'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†': center.totalStaff,
                'Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ': center.currentStaff,
                'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª': center.totalAmbulances,
                'Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©': center.activeAmbulances,
                'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©': center.inactiveAmbulances,
                'Ø§Ù„Ø¯Ø¹Ù…': center.supportAmbulances,
                'Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©': center.lifeSavingCases,
                'Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©': center.homeCases,
                'Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©': center.moderateCases,
                'Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©': center.stableCases,
                'Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©': center.responseTime,
                'Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„ØµØ­ÙŠØ©': center.healthCenterCases,
                'Ø§Ù„Ø­Ø§Ù„Ø©': center.status
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§ÙÙŠØ©");
            XLSX.writeFile(wb, "ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø±Ø§ÙƒØ²_Ø§Ù„Ø¥Ø³Ø¹Ø§ÙÙŠØ©.xlsx");
            closeExportModal();
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø®Ø·
            doc.setFontSize(16);
            doc.text('Emergency Centers Report', 20, 20);
            doc.text('Jeddah Health Cluster 2', 20, 30);
            
            doc.setFontSize(12);
            let yPosition = 50;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
            doc.text('General Statistics:', 20, yPosition);
            yPosition += 10;
            doc.text(`Total Staff: ${emergencyCenters.reduce((sum, center) => sum + center.totalStaff, 0)}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Current Staff: ${emergencyCenters.reduce((sum, center) => sum + center.currentStaff, 0)}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Total Ambulances: ${emergencyCenters.reduce((sum, center) => sum + center.totalAmbulances, 0)}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Active Ambulances: ${emergencyCenters.reduce((sum, center) => sum + center.activeAmbulances, 0)}`, 20, yPosition);
            yPosition += 8;
            doc.text(`Response Time: ${globalResponseTime} minutes`, 20, yPosition);
            yPosition += 15;
            
            // Ø¥Ø¶Ø§ÙØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø§ÙƒØ²
            doc.text('Centers Details:', 20, yPosition);
            yPosition += 10;
            
            emergencyCenters.forEach((center, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.text(`${index + 1}. ${center.name}`, 20, yPosition);
                yPosition += 8;
                doc.text(`   Location: ${center.location}`, 25, yPosition);
                yPosition += 6;
                doc.text(`   Staff: ${center.currentStaff}/${center.totalStaff}`, 25, yPosition);
                yPosition += 6;
                doc.text(`   Ambulances: ${center.activeAmbulances}/${center.totalAmbulances}`, 25, yPosition);
                yPosition += 6;
                doc.text(`   Response Time: ${center.responseTime} min`, 25, yPosition);
                yPosition += 6;
                doc.text(`   Cases - Life Saving: ${center.lifeSavingCases}, Moderate: ${center.moderateCases}`, 25, yPosition);
                yPosition += 6;
                doc.text(`   Cases - Stable: ${center.stableCases}, Home: ${center.homeCases}`, 25, yPosition);
                yPosition += 10;
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙ‚ÙŠØ¹
            yPosition += 10;
            doc.text('Emergency and Crisis Management Dashboard', 20, yPosition);
            yPosition += 8;
            doc.text('Jeddah Health Cluster 2', 20, yPosition);
            yPosition += 8;
            doc.text('Design by Hafalobaidi | Version 6.0.0', 20, yPosition);
            
            doc.save('emergency_centers_report.pdf');
            closeExportModal();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª
        function showCasesSummaryModal() {
            const content = document.getElementById('casesSummaryContent');
            
            const totalLifeSaving = emergencyCenters.reduce((sum, center) => sum + center.lifeSavingCases, 0);
            const totalModerate = emergencyCenters.reduce((sum, center) => sum + center.moderateCases, 0);
            const totalStable = emergencyCenters.reduce((sum, center) => sum + center.stableCases, 0);
            const totalHome = emergencyCenters.reduce((sum, center) => sum + center.homeCases, 0);
            const totalCases = totalLifeSaving + totalModerate + totalStable + totalHome;
            
            content.innerHTML = `
                <div class="bg-white/5 rounded-lg p-4 mb-4">
                    <h4 class="text-white font-bold mb-3">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="bg-red-500/20 rounded-lg p-3 text-center">
                            <p class="text-red-200 text-sm">Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø­ÙŠØ§Ø©</p>
                            <p class="text-white font-bold text-xl">${totalLifeSaving}</p>
                            <p class="text-red-300 text-xs">${((totalLifeSaving/totalCases)*100).toFixed(1)}%</p>
                        </div>
                        <div class="bg-orange-500/20 rounded-lg p-3 text-center">
                            <p class="text-orange-200 text-sm">Ø­Ø§Ù„Ø§Øª Ù…ØªÙˆØ³Ø·Ø©</p>
                            <p class="text-white font-bold text-xl">${totalModerate}</p>
                            <p class="text-orange-300 text-xs">${((totalModerate/totalCases)*100).toFixed(1)}%</p>
                        </div>
                        <div class="bg-green-500/20 rounded-lg p-3 text-center">
                            <p class="text-green-200 text-sm">Ø­Ø§Ù„Ø§Øª Ù…Ø³ØªÙ‚Ø±Ø©</p>
                            <p class="text-white font-bold text-xl">${totalStable}</p>
                            <p class="text-green-300 text-xs">${((totalStable/totalCases)*100).toFixed(1)}%</p>
                        </div>
                        <div class="bg-blue-500/20 rounded-lg p-3 text-center">
                            <p class="text-blue-200 text-sm">Ø­Ø§Ù„Ø§Øª Ù…Ù†Ø²Ù„ÙŠØ©</p>
                            <p class="text-white font-bold text-xl">${totalHome}</p>
                            <p class="text-blue-300 text-xs">${((totalHome/totalCases)*100).toFixed(1)}%</p>
                        </div>
                    </div>
                    <div class="mt-4 text-center">
                        <p class="text-white font-bold text-lg">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª: ${totalCases}</p>
                    </div>
                </div>
                
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-white font-bold mb-3">ğŸ¥ ØªÙØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø±Ø§ÙƒØ²</h4>
                    <div class="space-y-3">
                        ${emergencyCenters.map(center => {
                            const centerTotal = center.lifeSavingCases + center.moderateCases + center.stableCases + center.homeCases;
                            return `
                                <div class="bg-white/5 rounded-lg p-3">
                                    <h5 class="text-white font-medium mb-2">${center.name}</h5>
                                    <div class="grid grid-cols-4 gap-2 text-xs">
                                        <div class="text-red-300">Ø¥Ù†Ù‚Ø§Ø°: ${center.lifeSavingCases}</div>
                                        <div class="text-orange-300">Ù…ØªÙˆØ³Ø·Ø©: ${center.moderateCases}</div>
                                        <div class="text-green-300">Ù…Ø³ØªÙ‚Ø±Ø©: ${center.stableCases}</div>
                                        <div class="text-blue-300">Ù…Ù†Ø²Ù„ÙŠØ©: ${center.homeCases}</div>
                                    </div>
                                    <div class="mt-2 text-white/70 text-xs">Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${centerTotal} Ø­Ø§Ù„Ø©</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('casesSummaryModal').style.display = 'flex';
        }

        function closeCasesSummaryModal() {
            document.getElementById('casesSummaryModal').style.display = 'none';
        }

        function printCasesSummary() {
            const content = document.getElementById('casesSummaryContent').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø©</title>
                    <style>
                        body { font-family: Arial, sans-serif; direction: rtl; }
                        .bg-white\\/5 { background: #f5f5f5; border: 1px solid #ddd; }
                        .rounded-lg { border-radius: 8px; }
                        .p-4 { padding: 16px; }
                        .mb-4 { margin-bottom: 16px; }
                        .grid { display: grid; }
                        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
                        .gap-4 { gap: 16px; }
                        .text-center { text-align: center; }
                        .font-bold { font-weight: bold; }
                        .text-xl { font-size: 1.25rem; }
                        .text-lg { font-size: 1.125rem; }
                        .text-sm { font-size: 0.875rem; }
                        .text-xs { font-size: 0.75rem; }
                        .mt-4 { margin-top: 16px; }
                        .space-y-3 > * + * { margin-top: 12px; }
                    </style>
                </head>
                <body>
                    <h1>Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø© - ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</h1>
                    ${content}
                    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666;">
                        <p>ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«</p>
                        <p>ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</p>
                        <p>ØªØµÙ…ÙŠÙ… Hafalobaidi | Ø§Ù„Ù†Ø³Ø®Ø© 6.0.0</p>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©
        function showHistoricalDataModal() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('historicalDate').value = today;
            document.getElementById('historicalDataModal').style.display = 'flex';
        }

        function closeHistoricalDataModal() {
            document.getElementById('historicalDataModal').style.display = 'none';
        }

        function loadTodayData() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('historicalDate').value = today;
            loadHistoricalData();
        }

        function loadYesterdayData() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('historicalDate').value = yesterday.toISOString().split('T')[0];
            loadHistoricalData();
        }

        function loadHistoricalData() {
            const selectedDate = document.getElementById('historicalDate').value;
            const content = document.getElementById('historicalDataContent');
            
            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            const historicalData = {
                totalStaff: Math.floor(Math.random() * 20) + 120,
                activeAmbulances: Math.floor(Math.random() * 10) + 25,
                totalCases: Math.floor(Math.random() * 50) + 200,
                responseTime: (Math.random() * 2 + 3).toFixed(1)
            };
            
            content.innerHTML = `
                <div class="bg-white/5 rounded-lg p-4">
                    <h4 class="text-white font-bold mb-3">ğŸ“… Ø¨ÙŠØ§Ù†Ø§Øª ${selectedDate}</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-purple-500/20 rounded-lg p-3">
                            <p class="text-purple-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†</p>
                            <p class="text-white font-bold text-xl">${historicalData.totalStaff}</p>
                        </div>
                        <div class="bg-green-500/20 rounded-lg p-3">
                            <p class="text-green-200 text-sm">Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</p>
                            <p class="text-white font-bold text-xl">${historicalData.activeAmbulances}</p>
                        </div>
                        <div class="bg-blue-500/20 rounded-lg p-3">
                            <p class="text-blue-200 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª</p>
                            <p class="text-white font-bold text-xl">${historicalData.totalCases}</p>
                        </div>
                        <div class="bg-yellow-500/20 rounded-lg p-3">
                            <p class="text-yellow-200 text-sm">Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</p>
                            <p class="text-white font-bold text-xl">${historicalData.responseTime} Ø¯Ù‚ÙŠÙ‚Ø©</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø±Ø¶
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function printDashboard() {
            window.print();
        }

        function toggleSettings() {
            const dropdown = document.getElementById('settingsDropdown');
            dropdown.classList.toggle('show');
        }

        function setRefreshInterval() {
            const interval = parseInt(document.getElementById('refreshInterval').value);
            
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            
            if (interval > 0) {
                refreshInterval = setInterval(async () => {
                    updateLastUpdateTime();
                    try {
                        await loadAllDataFromSupabase();
                        forceUpdateAllCards();
                    } catch (error) {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    }
                    saveDataToStorage(true);
                }, interval);
                }, interval);
                
                // Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)
                const intervalText = interval === 10000 ? '10 Ø«ÙˆØ§Ù†' :
                                   interval === 15000 ? '15 Ø«Ø§Ù†ÙŠØ©' : 
                                   interval === 30000 ? '30 Ø«Ø§Ù†ÙŠØ©' : 
                                   interval === 60000 ? 'Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©' : 
                                   interval === 300000 ? '5 Ø¯Ù‚Ø§Ø¦Ù‚' : 
                                   interval === 900000 ? '15 Ø¯Ù‚ÙŠÙ‚Ø©' : 'Ù…Ø®ØµØµ';
                
                showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', `Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¹Ø±Ø¶ ÙƒÙ„ ${intervalText}`, 'info');
            } else {
                showNotification('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ', 'Ù„Ù† ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹', 'warning');
            }
        }
        
        
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA');
            document.getElementById('lastUpdate').textContent = timeString;
        }

        function zoomIn() {
            if (currentZoom < 125) {
                currentZoom += 10;
                applyZoom();
            }
        }

        function zoomOut() {
            if (currentZoom > 75) {
                currentZoom -= 10;
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 100;
            applyZoom();
        }

        function applyZoom() {
            const content = document.getElementById('dashboardContent');
            content.style.transform = `scale(${currentZoom / 100})`;
            content.style.transformOrigin = 'top center';
            
            // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù„Ù…Ù†Ø¹ Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            if (currentZoom < 100) {
                content.style.marginBottom = `${(100 - currentZoom) * 2}px`;
            } else {
                content.style.marginBottom = '0px';
            }
            
            document.getElementById('zoomLevel').textContent = currentZoom + '%';
        }

        // ÙˆØ¸Ø§Ø¦Ù ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø±Ø§ÙƒØ²
        function editCenter(centerId) {
            const center = emergencyCenters.find(c => c.id === centerId);
            if (!center) return;

            // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            document.getElementById('centerName').value = center.name;
            document.getElementById('centerLocation').value = center.location;
            document.getElementById('totalStaffInput').value = center.totalStaff;
            document.getElementById('currentStaffInput').value = center.currentStaff;
            document.getElementById('totalAmbulancesInput').value = center.totalAmbulances;
            document.getElementById('activeAmbulancesInput').value = center.activeAmbulances;
            document.getElementById('inactiveAmbulancesInput').value = center.inactiveAmbulances;
            document.getElementById('supportAmbulancesInput').value = center.supportAmbulances;
            document.getElementById('lifeSavingCasesInput').value = center.lifeSavingCases;
            document.getElementById('homeCasesInput').value = center.homeCases;
            document.getElementById('moderateCasesInput').value = center.moderateCases;
            document.getElementById('stableCasesInput').value = center.stableCases;
            document.getElementById('responseTimeInput').value = center.responseTime;
            document.getElementById('healthCenterCasesInput').value = center.healthCenterCases;

            // ØªØºÙŠÙŠØ± ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø²Ø± Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¶Ø§ÙØ©
            const modal = document.getElementById('addCenterModal');
            const title = modal.querySelector('.login-title');
            const button = document.getElementById('addCenterBtn');
            
            title.textContent = 'âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ';
            button.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ²';
            button.onclick = function() { window.updateCenter(centerId); };
            
            modal.style.display = 'flex';
        }

        function updateCenter(centerId) {
            const centerIndex = emergencyCenters.findIndex(c => c.id === centerId);
            if (centerIndex === -1) return;

            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const totalStaff = parseInt(document.getElementById('totalStaffInput').value) || 0;
            const currentStaff = parseInt(document.getElementById('currentStaffInput').value) || 0;
            const totalAmbulances = parseInt(document.getElementById('totalAmbulancesInput').value) || 0;
            const activeAmbulances = parseInt(document.getElementById('activeAmbulancesInput').value) || 0;
            const inactiveAmbulances = parseInt(document.getElementById('inactiveAmbulancesInput').value) || 0;
            const supportAmbulances = parseInt(document.getElementById('supportAmbulancesInput').value) || 0;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (currentStaff > totalStaff) {
                alert('âŒ Ø®Ø·Ø£: Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…ØªÙˆÙØ±ÙŠÙ† (' + currentStaff + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalStaff + ')');
                return;
            }
            
            if (activeAmbulances > totalAmbulances) {
                alert('âŒ Ø®Ø·Ø£: Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø© (' + activeAmbulances + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalAmbulances + ')');
                return;
            }
            
            if ((inactiveAmbulances + supportAmbulances + activeAmbulances) > totalAmbulances) {
                alert('âŒ Ø®Ø·Ø£: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª (' + (inactiveAmbulances + supportAmbulances + activeAmbulances) + ') Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ (' + totalAmbulances + ')');
                return;
            }

            emergencyCenters[centerIndex] = {
                ...emergencyCenters[centerIndex],
                name: document.getElementById('centerName').value,
                location: document.getElementById('centerLocation').value,
                totalStaff: totalStaff,
                currentStaff: currentStaff,
                totalAmbulances: totalAmbulances,
                activeAmbulances: activeAmbulances,
                inactiveAmbulances: inactiveAmbulances,
                supportAmbulances: supportAmbulances,
                lifeSavingCases: parseInt(document.getElementById('lifeSavingCasesInput').value) || 0,
                homeCases: parseInt(document.getElementById('homeCasesInput').value) || 0,
                moderateCases: parseInt(document.getElementById('moderateCasesInput').value) || 0,
                stableCases: parseInt(document.getElementById('stableCasesInput').value) || 0,
                healthCenterCases: parseInt(document.getElementById('healthCenterCasesInput').value) || 0
            };

            forceUpdateAllCards();
            // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­
            forceUpdateAllCards();
            resetAddCenterModal();
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Supabase
            syncManager.saveData('emergencyCenters', emergencyCenters).then(() => {
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Supabase');
                
                // Ø¨Ø« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
                if (typeof BroadcastChannel !== 'undefined') {
                    const channel = new BroadcastChannel('emergency_dashboard_updates');
                    channel.postMessage({
                        type: 'centers_updated',
                        action: 'update',
                        timestamp: Date.now()
                    });
                    console.log('ğŸ“¢ ØªÙ… Ø¨Ø« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«');
                    setTimeout(() => {
                        channel.close();
                    }, 500);
                }
            }).catch(error => {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            });
            
            // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ² Ù„Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
            document.dispatchEvent(new CustomEvent('centerUpdated'));
            
            showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Supabase', 'success');
        }

        function deleteCenter(centerId) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙƒØ²ØŸ')) {
                emergencyCenters = emergencyCenters.filter(c => c.id !== centerId);
                
                // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­
                forceUpdateAllCards();
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Supabase
                syncManager.saveData('emergencyCenters', emergencyCenters).then(() => {
                    console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Supabase');
                    
                    // Ø¨Ø« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«
                    if (typeof BroadcastChannel !== 'undefined') {
                        const channel = new BroadcastChannel('emergency_dashboard_updates');
                        channel.postMessage({
                            type: 'centers_updated',
                            action: 'delete',
                            timestamp: Date.now()
                        });
                        console.log('ğŸ“¢ ØªÙ… Ø¨Ø« Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø°Ù');
                        setTimeout(() => {
                            channel.close();
                        }, 500);
                    }
                }).catch(error => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                });
                
                // Ø¥Ø·Ù„Ø§Ù‚ Ø­Ø¯Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ² Ù„Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                document.dispatchEvent(new CustomEvent('centerUpdated'));
                
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ² Ø¨Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Supabase', 'success');
            }
        }

        function resetAddCenterModal() {
            const modal = document.getElementById('addCenterModal');
            const title = modal.querySelector('.login-title');
            const button = document.getElementById('addCenterBtn');
            
            title.textContent = 'â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¥Ø³Ø¹Ø§ÙÙŠ Ø¬Ø¯ÙŠØ¯';
            button.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙƒØ²';
            button.onclick = function() { window.addCenter(); };
            
            modal.style.display = 'none';
            clearAddCenterForm();
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
        document.addEventListener('click', function(event) {
            const settingsBtn = document.querySelector('.settings-btn');
            const settingsDropdown = document.getElementById('settingsDropdown');
            
            if (!settingsBtn.contains(event.target)) {
                settingsDropdown.classList.remove('show');
            }
        });

        // Ø¯Ø¹Ù… Ù…ÙØªØ§Ø­ Enter ÙÙŠ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        document.getElementById('loginPassword').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                attemptLogin();
            }
        });

        // ÙˆØ¸Ø§Ø¦Ù ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        let adminPassword = 'admin123';

        function showChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'flex';
        }

        function closeChangePasswordModal() {
            document.getElementById('changePasswordModal').style.display = 'none';
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            document.getElementById('passwordChangeError').style.display = 'none';
        }

        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const errorDiv = document.getElementById('passwordChangeError');

            if (currentPassword !== adminPassword) {
                errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword.length < 6) {
                errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
                errorDiv.style.display = 'block';
                return;
            }

            if (newPassword !== confirmPassword) {
                errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØªØ£ÙƒÙŠØ¯Ù‡Ø§ ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚ÙŠÙ†';
                errorDiv.style.display = 'block';
                return;
            }

            adminPassword = newPassword;
            closeChangePasswordModal();
            alert('ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­!');
        }

        // Ø¥ØµÙ„Ø§Ø­ ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
        window.attemptLogin = function() {
            const password = document.getElementById('loginPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (password === adminPassword) {
                window.isAdminMode = true;
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('adminControls').style.display = 'block';
                document.getElementById('printButton').classList.add('admin-mode');
                document.getElementById('loginPassword').value = '';
                errorDiv.style.display = 'none';
                displayCenters();
            } else {
                errorDiv.textContent = 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©';
                errorDiv.style.display = 'block';
            }
        }

        // Ø¥ØµÙ„Ø§Ø­ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ù…Ù†ÙŠ
        function loadHistoricalData() {
            const selectedDate = document.getElementById('historicalDate').value;
            const contentDiv = document.getElementById('historicalDataContent');
            
            if (!selectedDate) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            // Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
            const historicalData = generateHistoricalData(selectedDate);
            
            contentDiv.innerHTML = `
                <div class="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-purple-300/20 mb-4">
                    <h3 class="text-white font-bold mb-3">ğŸ“… Ø¨ÙŠØ§Ù†Ø§Øª ${selectedDate}</h3>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="text-white/80">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª: <span class="text-white font-bold">${historicalData.totalCases}</span></div>
                        <div class="text-white/80">Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: <span class="text-white font-bold">${historicalData.activeStaff}</span></div>
                        <div class="text-white/80">Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©: <span class="text-white font-bold">${historicalData.activeAmbulances}</span></div>
                        <div class="text-white/80">Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: <span class="text-white font-bold">${historicalData.responseTime} Ø¯Ù‚ÙŠÙ‚Ø©</span></div>
                    </div>
                    <div class="mt-4 pt-3 border-t border-white/20">
                        <button onclick="printHistoricalData('${selectedDate}')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm w-full">
                            ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©
                        </button>
                    </div>
                </div>
            `;
        }

        function generateHistoricalData(date) {
            // ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const baseDate = new Date(date);
            const dayOffset = Math.floor(Math.random() * 50);
            
            return {
                totalCases: 180 + dayOffset,
                activeStaff: 110 + Math.floor(Math.random() * 20),
                activeAmbulances: 25 + Math.floor(Math.random() * 10),
                responseTime: (3.5 + Math.random() * 2).toFixed(1)
            };
        }

        function printHistoricalData(date) {
            const printWindow = window.open('', '_blank');
            const historicalData = generateHistoricalData(date);
            
            printWindow.document.write(`
                <html dir="rtl">
                <head>
                    <title>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© - ${date}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .data-table { width: 100%; border-collapse: collapse; }
                        .data-table th, .data-table td { border: 1px solid #ddd; padding: 12px; text-align: right; }
                        .data-table th { background-color: #f5f5f5; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©</h1>
                        <h2>ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ</h2>
                        <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}</p>
                    </div>
                    <table class="data-table">
                        <tr><th>Ø§Ù„Ø¨ÙŠØ§Ù†</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø©</th></tr>
                        <tr><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª</td><td>${historicalData.totalCases}</td></tr>
                        <tr><td>Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</td><td>${historicalData.activeStaff}</td></tr>
                        <tr><td>Ø§Ù„Ø¥Ø³Ø¹Ø§ÙØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</td><td>${historicalData.activeAmbulances}</td></tr>
                        <tr><td>Ø²Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</td><td>${historicalData.responseTime} Ø¯Ù‚ÙŠÙ‚Ø©</td></tr>
                    </table>
                    <div style="margin-top: 30px; text-align: center; font-size: 12px; color: #666;">
                        <p>ØªØµÙ…ÙŠÙ… Ø®Ø§Øµ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ§Ù„Ø£Ø²Ù…Ø§Øª ÙˆØ§Ù„ÙƒÙˆØ§Ø±Ø«</p>
                        <p>ØªØ¬Ù…Ø¹ Ø¬Ø¯Ø© Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø«Ø§Ù†ÙŠ | ØªØµÙ…ÙŠÙ… Hafalobaidi</p>
                    </div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        function loadTodayData() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('historicalDate').value = today;
            loadHistoricalData();
        }

        function loadYesterdayData() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            document.getElementById('historicalDate').value = yesterday.toISOString().split('T')[0];
            loadHistoricalData();
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø©
        function showNotification(title, message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">${icons[type]}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 4 Ø«ÙˆØ§Ù†
            setTimeout(() => {
                notification.classList.add('slide-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ù…Ù†ÙŠ - Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ø§Ø¨ØªØ© Ù„ÙƒÙ„ ØªØ§Ø±ÙŠØ®
        const historicalDataCache = {};

        function generateHistoricalData(date) {
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§
            if (historicalDataCache[date]) {
                return historicalDataCache[date];
            }
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø«Ø§Ø¨ØªØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ®
            const baseDate = new Date(date);
            const dayOfYear = Math.floor((baseDate - new Date(baseDate.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… seed Ø«Ø§Ø¨Øª Ù„ÙƒÙ„ ØªØ§Ø±ÙŠØ® Ù„Ø¶Ù…Ø§Ù† Ø«Ø¨Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const seed = dayOfYear * 37; // Ø±Ù‚Ù… Ø«Ø§Ø¨Øª Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù…ØªØ³Ù‚Ø©
            
            const data = {
                totalCases: 150 + (seed % 80),
                activeStaff: 100 + (seed % 30),
                activeAmbulances: 20 + (seed % 15),
                responseTime: (3.0 + ((seed % 20) / 10)).toFixed(1)
            };
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            historicalDataCache[date] = data;
            return data;
        }
        
        // Ù†Ø¸Ø§Ù… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù… Ø§Ù„Ù…Ø­Ø³Ù†
        function saveDataToStorage(silent = false) {
            try {
                const dataToSave = {
                    emergencyCenters: emergencyCenters,
                    globalResponseTime: globalResponseTime,
                    currentZoom: currentZoom,
                    lastUpdate: new Date().toISOString(),
                    version: '6.0.0'
                };
                localStorage.setItem('emergencyDashboardData', JSON.stringify(dataToSave));
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ:', new Date().toLocaleTimeString('ar-SA'));
                return true;
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                if (!silent) {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªØ¹Ø°Ø± Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­', 'error');
                }
                return false;
            }
        }
        
        function loadDataFromStorage() {
            // Ø¹Ø¯Ù… ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„Ø¨Ø¯Ø¡ Ø¨ØµÙØ­Ø© ÙØ§Ø±ØºØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹
            console.log('ØªÙ… ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© - Ø§Ù„Ø¨Ø¯Ø¡ Ø¨ØµÙØ­Ø© ÙØ§Ø±ØºØ©');
            return false;
        }
        
        function clearStoredData() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©ØŸ\nØ³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©.')) {
                localStorage.removeItem('emergencyDashboardData');
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©', 'Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©...', 'info');
                setTimeout(() => {
                    location.reload();
                }, 2000);
            }
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø­ÙØ¸ ÙŠØ¯ÙˆÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function manualSave() {
            if (saveDataToStorage()) {
                showNotification('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­', 'ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©', 'success');
            }
        }
        
        // ÙˆØ¸ÙŠÙØ© ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function exportData() {
            try {
                const dataToExport = {
                    emergencyCenters: emergencyCenters,
                    globalResponseTime: globalResponseTime,
                    exportDate: new Date().toISOString(),
                    version: '6.0.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `emergency_dashboard_backup_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                URL.revokeObjectURL(url);
                showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±', 'ØªØ¹Ø°Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }
        
        // Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
        let currentTarget = 92; // Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
        
        function editTarget() {
            const newTarget = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©):', currentTarget);
            if (newTarget !== null && !isNaN(newTarget) && newTarget >= 0 && newTarget <= 100) {
                currentTarget = parseInt(newTarget);
                document.getElementById('performanceTarget').textContent = currentTarget + '%';
                
                // Ø­ÙØ¸ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
                saveDataToStorage(true);
                showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡Ø¯Ù', `Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯: ${currentTarget}%`, 'success');
            } else if (newTarget !== null) {
                showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø¨ÙŠÙ† 0 Ùˆ 100', 'error');
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© - ÙÙ‚Ø· Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù…Ø§ÙŠØ©
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©...');
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ù…Ø§ÙŠØ©
            const protectionModal = document.getElementById('mainProtectionModal');
            const protectedContent = document.getElementById('protectedContent');
            
            if (protectionModal && protectedContent) {
                // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„Ø­Ù…Ø§ÙŠØ©
                protectionModal.style.display = 'flex';
                protectedContent.classList.add('hidden');
                console.log('ØªÙ… ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©');
            } else {
                console.log('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ù…Ø§ÙŠØ©');
            }
        });;

// ===== Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ© =====

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø¬Ø§Ø±ÙŠØ©
let emergencyAlertSettings = {
    isActive: false,
    icon: 'Ø¥Ù†Ø°Ø§Ø± Ø¹Ø§Ù…',
    description: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø¬Ø§Ø±ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹'
};

// Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…ØªØ¹Ø¯Ø¯Ø©
let emergencyEvents = []; // Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«

// ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
function loadEmergencyAlertSettings() {
    try {
        const saved = localStorage.getItem('emergencyAlertSettings');
        if (saved) {
            emergencyAlertSettings = JSON.parse(saved);
        }
        
        const savedEvents = localStorage.getItem('emergencyEvents');
        if (savedEvents) {
            emergencyEvents = JSON.parse(savedEvents);
        }
        
        updateEmergencyAlertDisplay();
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
    }
}

// Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
function saveEmergencyAlertSettings() {
    try {
        localStorage.setItem('emergencyAlertSettings', JSON.stringify(emergencyAlertSettings));
        localStorage.setItem('emergencyEvents', JSON.stringify(emergencyEvents));
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function updateEmergencyAlertDisplay() {
    try {
        const alertElement = document.getElementById('emergencyAlert');
        const iconElement = document.getElementById('emergencyIcon');
        const textElement = document.getElementById('emergencyText');
        
        if (alertElement && iconElement && textElement) {
            if (emergencyAlertSettings.isActive && emergencyEvents.length > 0) {
                alertElement.style.display = 'block';
                
                // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                let eventsText = '';
                emergencyEvents.forEach((event, index) => {
                    if (index > 0) eventsText += ' â€¢ ';
                    eventsText += `${event.icon} ${event.description}`;
                });
                
                iconElement.textContent = emergencyEvents[0].icon;
                textElement.textContent = eventsText;
            } else {
                alertElement.style.display = 'none';
            }
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
    }
}

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function showEmergencyAlertModal() {
    try {
        const modal = document.getElementById('emergencyAlertModal');
        
        if (modal) {
            updateModalStatus();
            updateEventsList();
            modal.style.display = 'flex';
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
function updateEventsList() {
    try {
        const eventsList = document.getElementById('eventsList');
        const eventsCount = document.getElementById('eventsCount');
        
        if (eventsList) {
            if (emergencyEvents.length === 0) {
                eventsList.innerHTML = '<div class="text-white/50 text-sm text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø«</div>';
            } else {
                eventsList.innerHTML = emergencyEvents.map((event, index) => `
                    <div class="bg-white/10 rounded-lg p-3 border border-white/20 flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 space-x-reverse mb-1">
                                <span class="text-2xl">${event.icon}</span>
                                <span class="text-white font-medium text-sm">Ø­Ø¯Ø« ${index + 1}</span>
                            </div>
                            <p class="text-white/80 text-sm">${event.description}</p>
                        </div>
                        <button onclick="deleteEvent(${index})" class="text-red-400 hover:text-red-300 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `).join('');
            }
        }
        
        if (eventsCount) {
            eventsCount.textContent = `${emergencyEvents.length} ${emergencyEvents.length === 1 ? 'Ø­Ø¯Ø«' : emergencyEvents.length === 2 ? 'Ø­Ø¯Ø«Ø§Ù†' : 'Ø£Ø­Ø¯Ø§Ø«'}`;
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«:', error);
    }
}

// Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯
function addNewEvent() {
    try {
        const iconInput = document.getElementById('newEventIcon');
        const descriptionInput = document.getElementById('newEventDescription');
        
        if (iconInput && descriptionInput) {
            const icon = iconInput.value.trim() || 'ğŸš¨';
            const description = descriptionInput.value.trim();
            
            if (!description) {
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ø­Ø¯Ø«');
                return;
            }
            
            emergencyEvents.push({
                icon: icon,
                description: description,
                timestamp: new Date().toISOString()
            });
            
            saveEmergencyAlertSettings();
            updateEventsList();
            updateEmergencyAlertDisplay();
            
            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
            iconInput.value = '';
            descriptionInput.value = '';
            
            showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ø¯Ø«:', error);
    }
}

// Ø­Ø°Ù Ø­Ø¯Ø«
function deleteEvent(index) {
    try {
        if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯Ø«ØŸ')) {
            emergencyEvents.splice(index, 1);
            saveEmergencyAlertSettings();
            updateEventsList();
            updateEmergencyAlertDisplay();
            showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­Ø¯Ø« Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø­Ø¯Ø«:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø±ÙŠØ· ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
function updateModalStatus() {
    try {
        const statusText = document.getElementById('alertStatusText');
        const statusIndicator = document.getElementById('alertStatusIndicator');
        const toggleBtn = document.getElementById('toggleAlertBtn');
        
        if (emergencyAlertSettings.isActive) {
            if (statusText) statusText.textContent = 'Ù†Ø´Ø·';
            if (statusIndicator) statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full animate-pulse';
            if (toggleBtn) {
                toggleBtn.textContent = 'Ø¥ÙŠÙ‚Ø§Ù Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«';
                toggleBtn.className = 'w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200';
            }
        } else {
            if (statusText) statusText.textContent = 'Ù…Ø®ÙÙŠ';
            if (statusIndicator) statusIndicator.className = 'w-3 h-3 bg-gray-500 rounded-full';
            if (toggleBtn) {
                toggleBtn.textContent = 'ØªØ´ØºÙŠÙ„ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«';
                toggleBtn.className = 'w-full bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg font-medium transition-all duration-200';
            }
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø©:', error);
    }
}

// ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function toggleEmergencyAlert() {
    try {
        emergencyAlertSettings.isActive = !emergencyAlertSettings.isActive;
        updateModalStatus();
        updateEmergencyAlertDisplay();
        saveEmergencyAlertSettings();
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ¨Ø¯ÙŠÙ„ Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø±ÙŠØ·:', error);
    }
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
function closeEmergencyAlertModal() {
    try {
        const modal = document.getElementById('emergencyAlertModal');
        if (modal) {
            modal.style.display = 'none';
        }
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©:', error);
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadEmergencyAlertSettings();
});


// ===== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ø¥Ø­Ø§Ù„Ø§Øª =====

// Ù…ØªØºÙŠØ±Ø§Øª Ù„Ø­ÙØ¸ Ù‚ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
let sideMedicalCasesData = {
    lifeSavingCases: 0,
    emergencyCases: 0,
    stableCases: 0
};

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
function loadSideMedicalCasesData() {
    try {
        const saved = localStorage.getItem('sideMedicalCasesData');
        if (saved) {
            sideMedicalCasesData = JSON.parse(saved);
        }
        updateSideMedicalCasesDisplay();
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©:', error);
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
function saveSideMedicalCasesData() {
    try {
        localStorage.setItem('sideMedicalCasesData', JSON.stringify(sideMedicalCasesData));
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
function updateSideMedicalCasesDisplay() {
    try {
        const lifeSavingElement = document.getElementById('sideLifeSavingCases');
        const emergencyElement = document.getElementById('sideEmergencyCases');
        const stableElement = document.getElementById('sideStableCases');
        
        if (lifeSavingElement) lifeSavingElement.textContent = sideMedicalCasesData.lifeSavingCases;
        if (emergencyElement) emergencyElement.textContent = sideMedicalCasesData.emergencyCases;
        if (stableElement) stableElement.textContent = sideMedicalCasesData.stableCases;
    } catch (error) {
        console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©:', error);
    }
}

// ===== Ø¯ÙˆØ§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© =====
function editSideLifeSavingCases() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editSideLifeSavingModal');
    const input = document.getElementById('sideLifeSavingInput');
    
    if (modal && input) {
        input.value = sideMedicalCasesData.lifeSavingCases;
        modal.style.display = 'flex';
        setTimeout(() => input.focus(), 100);
    }
}

function saveSideLifeSavingCases() {
    const input = document.getElementById('sideLifeSavingInput');
    const value = parseInt(input.value) || 0;
    
    if (value >= 0) {
        sideMedicalCasesData.lifeSavingCases = value;
        saveSideMedicalCasesData();
        updateSideMedicalCasesDisplay();
        closeSideLifeSavingModal();
        showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    } else {
        showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
    }
}

function closeSideLifeSavingModal() {
    const modal = document.getElementById('editSideLifeSavingModal');
    if (modal) modal.style.display = 'none';
}

// ===== Ø¯ÙˆØ§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© =====
function editSideEmergencyCases() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editSideEmergencyModal');
    const input = document.getElementById('sideEmergencyInput');
    
    if (modal && input) {
        input.value = sideMedicalCasesData.emergencyCases;
        modal.style.display = 'flex';
        setTimeout(() => input.focus(), 100);
    }
}

function saveSideEmergencyCases() {
    const input = document.getElementById('sideEmergencyInput');
    const value = parseInt(input.value) || 0;
    
    if (value >= 0) {
        sideMedicalCasesData.emergencyCases = value;
        saveSideMedicalCasesData();
        updateSideMedicalCasesDisplay();
        closeSideEmergencyModal();
        showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    } else {
        showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
    }
}

function closeSideEmergencyModal() {
    const modal = document.getElementById('editSideEmergencyModal');
    if (modal) modal.style.display = 'none';
}

// ===== Ø¯ÙˆØ§Ù„ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø© =====
function editSideStableCases() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editSideStableModal');
    const input = document.getElementById('sideStableInput');
    
    if (modal && input) {
        input.value = sideMedicalCasesData.stableCases;
        modal.style.display = 'flex';
        setTimeout(() => input.focus(), 100);
    }
}

function saveSideStableCases() {
    const input = document.getElementById('sideStableInput');
    const value = parseInt(input.value) || 0;
    
    if (value >= 0) {
        sideMedicalCasesData.stableCases = value;
        saveSideMedicalCasesData();
        updateSideMedicalCasesDisplay();
        closeSideStableModal();
        showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
    } else {
        showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
    }
}

function closeSideStableModal() {
    const modal = document.getElementById('editSideStableModal');
    if (modal) modal.style.display = 'none';
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadSideMedicalCasesData();
});



// ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
function updateDateTime() {
    const now = new Date();
    
    // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£ÙŠØ§Ù… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
    const daysArabic = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
    const dayName = daysArabic[now.getDay()];
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    const day = String(now.getDate()).padStart(2, '0');
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const year = now.getFullYear();
    const dateStr = `${year}/${month}/${day}`;
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    const timeStr = `${hours}:${minutes}:${seconds}`;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
    const dayElement = document.getElementById('currentDay');
    const dateElement = document.getElementById('currentDate');
    const timeElement = document.getElementById('currentTime');
    
    if (dayElement) dayElement.textContent = dayName;
    if (dateElement) dateElement.textContent = dateStr;
    if (timeElement) timeElement.textContent = timeStr;
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
setInterval(updateDateTime, 1000);

// ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
updateDateTime();

// Modal Functions
window.showAddCenterModal = function() {
    const modal = document.getElementById('addCenterModal');
    if (modal) modal.style.display = 'flex';
};

window.closeAddCenterModal = function() {
    const modal = document.getElementById('addCenterModal');
    if (modal) modal.style.display = 'none';
};

window.openFacilityModal = function() {
    const modal = document.getElementById('addFacilityModal');
    if (modal) {
        modal.style.display = 'flex';
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (window.syncIntervalId) {
            clearInterval(window.syncIntervalId);
            window.syncIntervalId = null;
            console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
        }
    }
};






// ====== Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© ======

let bedCapacityData = {
    bed1: { facilityName: 'Ù…Ù†Ø´Ø£Ø© 1', bedType: 'Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', occupied: 0, total: 0 },
    bed2: { facilityName: 'Ù…Ù†Ø´Ø£Ø© 2', bedType: 'Ø£Ø³Ø±Ø© ICU', occupied: 0, total: 0 },
    bed3: { facilityName: 'Ù…Ù†Ø´Ø£Ø© 3', bedType: 'Ø£Ø³Ø±Ø© CCU', occupied: 0, total: 0 }
};

let currentEditingBed = null;

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© Ù…Ù† localStorage
function loadBedCapacityData() {
    const saved = localStorage.getItem('bedCapacityData');
    if (saved) {
        try {
            bedCapacityData = JSON.parse(saved);
            updateBedCapacityDisplay();
        } catch (e) {
            console.error('Error loading bed capacity data:', e);
        }
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª ÙˆØ§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©
let hospitalsBedsData = {
    hospital1: {
        name: 'ğŸ­ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ù„Ùƒ ÙÙ‡Ø¯',
        emergency: { occupied: 0, total: 0 },
        icu: { occupied: 0, total: 0 },
        ccu: { occupied: 0, total: 0 }
    },
    hospital2: {
        name: 'ğŸ­ Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ù…Ø¬Ù…Ø¹',
        emergency: { occupied: 0, total: 0 },
        icu: { occupied: 0, total: 0 },
        ccu: { occupied: 0, total: 0 }
    },
    hospital3: {
        name: 'ğŸ­ Ù…Ø³ØªØ´ÙÙ‰ Ø±Ø§Ø¨Øº',
        emergency: { occupied: 0, total: 0 },
        icu: { occupied: 0, total: 0 },
        ccu: { occupied: 0, total: 0 }
    }
};

let currentEditingHospital = null;

// ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„ÙƒÙ„ Ù…Ø³ØªØ´ÙÙ‰
let bedTypesVisibility = {
    hospital1: { emergency: true, icu: true, ccu: true, picu: true, nicu: true },
    hospital2: { emergency: true, icu: true, ccu: true, picu: true, nicu: true },
    hospital3: { emergency: true, icu: true, ccu: true, picu: true, nicu: true },
    customFacilities: {} // Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ø®ØµØµØ©
};

// ØªØ­Ù…ÙŠÙ„ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù…Ù† LocalStorage
function loadBedTypesVisibility() {
    const saved = localStorage.getItem('bedTypesVisibility');
    if (saved) {
        try {
            bedTypesVisibility = JSON.parse(saved);
        } catch (e) {
            console.error('Error loading bed types visibility:', e);
        }
    }
}

// Ø­ÙØ¸ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ÙÙŠ LocalStorage
// Ø¯Ø§Ù„Ø© ØªØ·Ø¨ÙŠÙ‚ ØªÙØ¶ÙŠÙ„Ø§Øª Ø±Ø¤ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
function applyBedTypesVisibility() {
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
    for (let i = 1; i <= 3; i++) {
        updateBedTypeDisplay(i, 'Ø·ÙˆØ§Ø±Ø¦');
        updateBedTypeDisplay(i, 'ICU');
        updateBedTypeDisplay(i, 'CCU');
        updateBedTypeDisplay(i, 'PICU');
        updateBedTypeDisplay(i, 'NICU');
    }
}

function saveBedTypesVisibility() {
    localStorage.setItem('bedTypesVisibility', JSON.stringify(bedTypesVisibility));
    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
    applyBedTypesVisibility();
}

// ØªØ­Ø¯ÙŠØ« Ø±Ø¤ÙŠØ© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
function toggleBedTypeVisibility(hospitalKey, bedType) {
    if (!bedTypesVisibility[hospitalKey]) {
        bedTypesVisibility[hospitalKey] = { emergency: true, icu: true, ccu: true, picu: true, nicu: true };
    }
    bedTypesVisibility[hospitalKey][bedType] = !bedTypesVisibility[hospitalKey][bedType];
    saveBedTypesVisibility();
    updateHospitalsBedsDisplay();
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø¤ÙŠØ© Ù†ÙˆØ¹ Ø£Ø³Ø±Ø© Ù…Ø¹ÙŠÙ†
function isBedTypeVisible(hospitalKey, bedType) {
    if (!bedTypesVisibility[hospitalKey]) {
        return true; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ù…Ø¹Ø±ÙˆØ¶
    }
    return bedTypesVisibility[hospitalKey][bedType] !== false;
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
function loadHospitalsBedsData() {
    const saved = localStorage.getItem('hospitalsBedsData');
    if (saved) {
        try {
            hospitalsBedsData = JSON.parse(saved);
        } catch (e) {
            console.error('Error loading hospitals beds data:', e);
        }
    }
    
    // ØªØ­Ù…ÙŠÙ„ ØªÙØ¶ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    loadBedTypesVisibility();
    
    updateHospitalsBedsDisplay();
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
function saveHospitalsBedsData() {
    localStorage.setItem('hospitalsBedsData', JSON.stringify(hospitalsBedsData));
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª
function updateHospitalsBedsDisplay() {
    for (let i = 1; i <= 3; i++) {
        const hospitalKey = `hospital${i}`;
        const data = hospitalsBedsData[hospitalKey];
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
        const nameEl = document.getElementById(`${hospitalKey}Name`);
        if (nameEl) nameEl.textContent = data.name;
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
        updateBedTypeDisplay(hospitalKey, 'Emergency', data.emergency);
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø±Ø© ICU
        updateBedTypeDisplay(hospitalKey, 'Icu', data.icu);
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø±Ø© CCU
        updateBedTypeDisplay(hospitalKey, 'Ccu', data.ccu);
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø±Ø© PICU Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (data.picu) {
            updateBedTypeDisplay(hospitalKey, 'Picu', data.picu);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø£Ø³Ø±Ø© NICU Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (data.nicu) {
            updateBedTypeDisplay(hospitalKey, 'Nicu', data.nicu);
        }
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù†ÙˆØ¹ Ø£Ø³Ø±Ø© Ù…Ø¹ÙŠÙ†
function updateBedTypeDisplay(hospitalKey, bedType, bedData) {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    const card = document.querySelector(`[id="${hospitalKey}Name"]`)?.closest('.bg-gradient-to-br');
    if (!card) return;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø¤ÙŠØ© Ø§Ù„Ù‚Ø³Ù…
    const bedTypeLower = bedType.toLowerCase();
    const isVisible = isBedTypeVisible(hospitalKey, bedTypeLower);
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± p Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
    const allParagraphs = Array.from(card.querySelectorAll('p'));
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ØµØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…
    const bedTypeLabel = allParagraphs.find(p => {
        const text = p.textContent;
        return (bedType === 'Ø·ÙˆØ§Ø±Ø¦' && text.includes('Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦')) ||
               (bedType === 'ICU' && text.includes('Ø£Ø³Ø±Ø© ICU')) ||
               (bedType === 'CCU' && text.includes('Ø£Ø³Ø±Ø© CCU')) ||
               (bedType === 'PICU' && text.includes('Ø£Ø³Ø±Ø© PICU')) ||
               (bedType === 'NICU' && text.includes('Ø£Ø³Ø±Ø© NICU'));
    });
    
    if (bedTypeLabel) {
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø£Ø¨ (Ø§Ù„Ù€ div Ø§Ù„Ø°ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø³Ù… ÙƒØ§Ù…Ù„Ø§Ù‹)
        let container = bedTypeLabel.parentElement;
        if (container && container.className === '') {
            container.style.display = isVisible ? 'block' : 'none';
        }
    }
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
function openBedTypesManager(hospitalNumber) {
    if (!isAdminMode) return;
    
    const hospitalKey = `hospital${hospitalNumber}`;
    const modal = document.getElementById('bedTypesManagerModal');
    
    if (!modal) {
        console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…');
        return;
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    document.getElementById('bedTypesManagerTitle').textContent = `Ø¥Ø¯Ø§Ø±Ø© Ø£Ù‚Ø³Ø§Ù… ${hospitalsBedsData[hospitalKey].name}`;
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
    const bedTypes = ['emergency', 'icu', 'ccu', 'picu', 'nicu'];
    const bedTypeLabels = {emergency: 'Ø·ÙˆØ§Ø±Ø¦', icu: 'ICU', ccu: 'CCU', picu: 'PICU', nicu: 'NICU'};
    
    const checkboxesContainer = document.getElementById('bedTypesCheckboxes');
    checkboxesContainer.innerHTML = '';
    
    bedTypes.forEach(bedType => {
        const isVisible = isBedTypeVisible(hospitalKey, bedType);
        const checkbox = document.createElement('label');
        checkbox.className = 'flex items-center space-x-3 mb-3 cursor-pointer';
        checkbox.innerHTML = `
            <input type="checkbox" ${isVisible ? 'checked' : ''} 
                   onchange="toggleBedTypeVisibility('${hospitalKey}', '${bedType}')" 
                   class="w-4 h-4 rounded">
            <span class="text-white">Ø¹Ø±Ø¶ Ø£Ø³Ø±Ø© ${bedTypeLabels[bedType]}</span>
        `;
        checkboxesContainer.appendChild(checkbox);
    });
    
    // ØªØ®Ø²ÙŠÙ† Ù…ÙØªØ§Ø­ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø­Ø§Ù„ÙŠ
    window.currentBedTypesHospital = hospitalKey;
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
    modal.style.display = 'flex';
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
function closeBedTypesManager() {
    const modal = document.getElementById('bedTypesManagerModal');
    if (modal) modal.style.display = 'none';
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ´ÙÙ‰
function editHospitalBeds(hospitalNumber) {
    if (!isAdminMode) return;
    
    currentEditingHospital = hospitalNumber;
    const hospitalKey = `hospital${hospitalNumber}`;
    const data = hospitalsBedsData[hospitalKey];
    
    // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    document.getElementById('hospitalNameInput').value = data.name.replace('ğŸ—ï¸ ', '');
    document.getElementById('emergencyOccupiedInput').value = data.emergency.occupied;
    document.getElementById('emergencyTotalInput').value = data.emergency.total;
    document.getElementById('icuOccupiedInput').value = data.icu.occupied;
    document.getElementById('icuTotalInput').value = data.icu.total;
    document.getElementById('ccuOccupiedInput').value = data.ccu.occupied;
    document.getElementById('ccuTotalInput').value = data.ccu.total;
    
    // Ù…Ù„Ø¡ Ø­Ù‚ÙˆÙ„ PICU ÙˆNICU Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (document.getElementById('picuOccupiedInput')) {
        document.getElementById('picuOccupiedInput').value = (data.picu && data.picu.occupied) || 0;
        document.getElementById('picuTotalInput').value = (data.picu && data.picu.total) || 0;
    }
    if (document.getElementById('nicuOccupiedInput')) {
        document.getElementById('nicuOccupiedInput').value = (data.nicu && data.nicu.occupied) || 0;
        document.getElementById('nicuTotalInput').value = (data.nicu && data.nicu.total) || 0;
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
    const modal = document.getElementById('editHospitalBedsModal');
    if (modal) modal.style.display = 'flex';
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
function saveHospitalBeds() {
    if (!currentEditingHospital) return;
    
    const hospitalName = document.getElementById('hospitalNameInput').value.trim();
    const emergencyOccupied = parseInt(document.getElementById('emergencyOccupiedInput').value) || 0;
    const emergencyTotal = parseInt(document.getElementById('emergencyTotalInput').value) || 0;
    const icuOccupied = parseInt(document.getElementById('icuOccupiedInput').value) || 0;
    const icuTotal = parseInt(document.getElementById('icuTotalInput').value) || 0;
    const ccuOccupied = parseInt(document.getElementById('ccuOccupiedInput').value) || 0;
    const ccuTotal = parseInt(document.getElementById('ccuTotalInput').value) || 0;
    const picuOccupied = parseInt(document.getElementById('picuOccupiedInput')?.value) || 0;
    const picuTotal = parseInt(document.getElementById('picuTotalInput')?.value) || 0;
    const nicuOccupied = parseInt(document.getElementById('nicuOccupiedInput')?.value) || 0;
    const nicuTotal = parseInt(document.getElementById('nicuTotalInput')?.value) || 0;
    
    if (!hospitalName) {
        showNotification('Ø®Ø·Ø£', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰', 'error');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø´ØºÙˆÙ„ Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    if (emergencyOccupied > emergencyTotal || icuOccupied > icuTotal || ccuOccupied > ccuTotal || picuOccupied > picuTotal || nicuOccupied > nicuTotal) {
        showNotification('Ø®Ø·Ø£', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ', 'error');
        return;
    }
    
    const hospitalKey = `hospital${currentEditingHospital}`;
    hospitalsBedsData[hospitalKey] = {
        name: 'ğŸ­ ' + hospitalName,
        emergency: { occupied: emergencyOccupied, total: emergencyTotal },
        icu: { occupied: icuOccupied, total: icuTotal },
        ccu: { occupied: ccuOccupied, total: ccuTotal },
        picu: { occupied: picuOccupied, total: picuTotal },
        nicu: { occupied: nicuOccupied, total: nicuTotal }
    };
    
    saveHospitalsBedsData();
    updateHospitalsBedsDisplay();
    closeHospitalBedsModal();
    showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', `ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ${hospitalName} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰
function closeHospitalBedsModal() {
    const modal = document.getElementById('editHospitalBedsModal');
    if (modal) modal.style.display = 'none';
    currentEditingHospital = null;
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadHospitalsBedsData();
});



// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    loadServicePurchaseData();
});

// Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
function editServicePurchase(type) {
    if (!isAdminMode) return;
    
    const labels = {
        'transferred': 'ØªÙ… Ø§Ù„Ù†Ù‚Ù„',
        'rejected': 'ØªÙ… Ø§Ù„Ø±ÙØ¶', 
        'pending': 'ØªØ­Øª Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡',
        'other': 'Ø£Ø®Ø±Ù‰'
    };
    
    const elementId = 'servicePurchase' + type.charAt(0).toUpperCase() + type.slice(1);
    const currentValue = document.getElementById(elementId).textContent;
    
    const newValue = prompt(`ØªØ¹Ø¯ÙŠÙ„ ${labels[type]}:`, currentValue);
    
    if (newValue !== null && !isNaN(newValue) && newValue >= 0) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        document.getElementById(elementId).textContent = parseInt(newValue) || 0;
        
        // Ø­Ø³Ø§Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ
        updateServicePurchaseTotal();
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const servicePurchaseData = {
            transferred: parseInt(document.getElementById('servicePurchaseTransferred').textContent) || 0,
            rejected: parseInt(document.getElementById('servicePurchaseRejected').textContent) || 0,
            pending: parseInt(document.getElementById('servicePurchasePending').textContent) || 0,
            other: parseInt(document.getElementById('servicePurchaseOther').textContent) || 0
        };
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('servicePurchaseData', JSON.stringify(servicePurchaseData));
        
        showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« ${labels[type]} Ø¨Ù†Ø¬Ø§Ø­`, 'success');
    }
}

// Ø¯Ø§Ù„Ø© Ø­Ø³Ø§Ø¨ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
function updateServicePurchaseTotal() {
    const transferred = parseInt(document.getElementById('servicePurchaseTransferred').textContent) || 0;
    const rejected = parseInt(document.getElementById('servicePurchaseRejected').textContent) || 0;
    const pending = parseInt(document.getElementById('servicePurchasePending').textContent) || 0;
    const other = parseInt(document.getElementById('servicePurchaseOther').textContent) || 0;
    
    const total = transferred + rejected + pending + other;
    
    const totalElement = document.getElementById('servicePurchaseTotal');
    if (totalElement) {
        totalElement.textContent = total;
    }
}

// Ø¯Ø§Ù„Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©
function editServicePurchaseTotal() {
    if (!isAdminMode) return;
    
    const currentTotal = document.getElementById('servicePurchaseTotal').textContent;
    const newTotal = prompt('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©:', currentTotal);
    
    if (newTotal !== null && !isNaN(newTotal) && newTotal >= 0) {
        const totalValue = parseInt(newTotal) || 0;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
        document.getElementById('servicePurchaseTotal').textContent = totalValue;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ
        const perItem = Math.floor(totalValue / 4);
        const remainder = totalValue % 4;
        
        // ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…
        document.getElementById('servicePurchaseTransferred').textContent = perItem + (remainder > 0 ? 1 : 0);
        document.getElementById('servicePurchaseRejected').textContent = perItem + (remainder > 1 ? 1 : 0);
        document.getElementById('servicePurchasePending').textContent = perItem + (remainder > 2 ? 1 : 0);
        document.getElementById('servicePurchaseOther').textContent = perItem;
        
        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        const servicePurchaseData = {
            transferred: parseInt(document.getElementById('servicePurchaseTransferred').textContent) || 0,
            rejected: parseInt(document.getElementById('servicePurchaseRejected').textContent) || 0,
            pending: parseInt(document.getElementById('servicePurchasePending').textContent) || 0,
            other: parseInt(document.getElementById('servicePurchaseOther').textContent) || 0
        };
        
        localStorage.setItem('servicePurchaseData', JSON.stringify(servicePurchaseData));
        
        showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
function loadServicePurchaseData() {
    const savedData = localStorage.getItem('servicePurchaseData');
    if (savedData) {
        const data = JSON.parse(savedData);
        
        if (document.getElementById('servicePurchaseTransferred')) {
            document.getElementById('servicePurchaseTransferred').textContent = data.transferred || 0;
        }
        if (document.getElementById('servicePurchaseRejected')) {
            document.getElementById('servicePurchaseRejected').textContent = data.rejected || 0;
        }
        if (document.getElementById('servicePurchasePending')) {
            document.getElementById('servicePurchasePending').textContent = data.pending || 0;
        }
        if (document.getElementById('servicePurchaseOther')) {
            document.getElementById('servicePurchaseOther').textContent = data.other || 0;
        }
    }
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    updateServicePurchaseTotal();
}

// ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª =====

// Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
let referralsData = {
    lifeSavingReferrals: 0,
    emergencyReferrals: 0
};

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ù…Ù† Supabase
async function loadReferralsData() {
    try {
        const data = await syncManager.loadData('referralsData');
        if (data) {
            referralsData = data;
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª');
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:', error);
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù„Ù‰ Supabase
async function saveReferralsData() {
    try {
        await syncManager.saveData('referralsData', referralsData);
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª');
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª
function updateReferralsDisplay() {
    const lifeSavingElement = document.getElementById('lifeSavingReferralsCount');
    const emergencyElement = document.getElementById('emergencyReferralsCount');
    
    if (lifeSavingElement) {
        lifeSavingElement.textContent = referralsData.lifeSavingReferrals || 0;
    }
    if (emergencyElement) {
        emergencyElement.textContent = referralsData.emergencyReferrals || 0;
    }
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©
function openLifeSavingReferralsModal() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editLifeSavingReferralsModal');
    const input = document.getElementById('lifeSavingReferralsInput');
    
    if (modal && input) {
        input.value = referralsData.lifeSavingReferrals || 0;
        modal.style.display = 'flex';
        setTimeout(() => input.focus(), 100);
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø©
function saveLifeSavingReferrals() {
    const input = document.getElementById('lifeSavingReferralsInput');
    const value = parseInt(input.value) || 0;
    
    if (value >= 0) {
        referralsData.lifeSavingReferrals = value;
        saveReferralsData().then(() => {
            updateReferralsDisplay();
            closeLifeSavingReferralsModal();
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¥Ø­Ø§Ù„Ø§Øª Ø¥Ù†Ù‚Ø§Ø° Ø§Ù„Ø­ÙŠØ§Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        });
    } else {
        showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
    }
}

function closeLifeSavingReferralsModal() {
    const modal = document.getElementById('editLifeSavingReferralsModal');
    if (modal) modal.style.display = 'none';
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©
function openEmergencyReferralsModal() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editEmergencyReferralsModal');
    const input = document.getElementById('emergencyReferralsInput');
    
    if (modal && input) {
        input.value = referralsData.emergencyReferrals || 0;
        modal.style.display = 'flex';
        setTimeout(() => input.focus(), 100);
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø©
function saveEmergencyReferrals() {
    const input = document.getElementById('emergencyReferralsInput');
    const value = parseInt(input.value) || 0;
    
    if (value >= 0) {
        referralsData.emergencyReferrals = value;
        saveReferralsData().then(() => {
            updateReferralsDisplay();
            closeEmergencyReferralsModal();
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·Ø§Ø±Ø¦Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        });
    } else {
        showNotification('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
    }
}

function closeEmergencyReferralsModal() {
    const modal = document.getElementById('editEmergencyReferralsModal');
    if (modal) modal.style.display = 'none';
}

// ===== Ø¥Ø¯Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© =====

// Ù…ØªØºÙŠØ±Ø§Øª Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
let servicePurchaseData = {
    totalCases: 0,
    transferredCases: 0,
    rejectedCases: 0,
    underProcessCases: 0,
    otherCases: 0
};

// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© Ù…Ù† Supabase
async function loadServicePurchaseData() {
    try {
        const data = await syncManager.loadData('servicePurchaseData');
        if (data) {
            servicePurchaseData = data;
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©');
            updateServicePurchaseDisplay();
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©:', error);
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¥Ù„Ù‰ Supabase
async function saveServicePurchaseData() {
    try {
        await syncManager.saveData('servicePurchaseData', servicePurchaseData);
        console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©');
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©:', error);
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
function updateServicePurchaseDisplay() {
    const totalElement = document.getElementById('servicePurchaseTotalCount');
    const transferredElement = document.getElementById('servicePurchaseTransferredCount');
    const rejectedElement = document.getElementById('servicePurchaseRejectedCount');
    const underProcessElement = document.getElementById('servicePurchaseUnderProcessCount');
    const otherElement = document.getElementById('servicePurchaseOtherCount');
    
    if (totalElement) totalElement.textContent = servicePurchaseData.totalCases || 0;
    if (transferredElement) transferredElement.textContent = servicePurchaseData.transferredCases || 0;
    if (rejectedElement) rejectedElement.textContent = servicePurchaseData.rejectedCases || 0;
    if (underProcessElement) underProcessElement.textContent = servicePurchaseData.underProcessCases || 0;
    if (otherElement) otherElement.textContent = servicePurchaseData.otherCases || 0;
}

// ÙØªØ­ Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
function openServicePurchaseModal() {
    if (!isAdminMode) return;
    
    const modal = document.getElementById('editServicePurchaseModal');
    if (modal) {
        // Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        document.getElementById('servicePurchaseTotalInput').value = servicePurchaseData.totalCases || 0;
        document.getElementById('servicePurchaseTransferredInput').value = servicePurchaseData.transferredCases || 0;
        document.getElementById('servicePurchaseRejectedInput').value = servicePurchaseData.rejectedCases || 0;
        document.getElementById('servicePurchaseUnderProcessInput').value = servicePurchaseData.underProcessCases || 0;
        document.getElementById('servicePurchaseOtherInput').value = servicePurchaseData.otherCases || 0;
        
        modal.style.display = 'flex';
    }
}

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©
function saveServicePurchase() {
    const totalInput = document.getElementById('servicePurchaseTotalInput');
    const transferredInput = document.getElementById('servicePurchaseTransferredInput');
    const rejectedInput = document.getElementById('servicePurchaseRejectedInput');
    const underProcessInput = document.getElementById('servicePurchaseUnderProcessInput');
    const otherInput = document.getElementById('servicePurchaseOtherInput');
    
    const total = parseInt(totalInput.value) || 0;
    const transferred = parseInt(transferredInput.value) || 0;
    const rejected = parseInt(rejectedInput.value) || 0;
    const underProcess = parseInt(underProcessInput.value) || 0;
    const other = parseInt(otherInput.value) || 0;
    
    if (total >= 0 && transferred >= 0 && rejected >= 0 && underProcess >= 0 && other >= 0) {
        servicePurchaseData.totalCases = total;
        servicePurchaseData.transferredCases = transferred;
        servicePurchaseData.rejectedCases = rejected;
        servicePurchaseData.underProcessCases = underProcess;
        servicePurchaseData.otherCases = other;
        
        saveServicePurchaseData().then(() => {
            updateServicePurchaseDisplay();
            closeServicePurchaseModal();
            showNotification('ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø±Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        });
    } else {
        showNotification('Ù‚ÙŠÙ… ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ØµØ­ÙŠØ­Ø©', 'error');
    }
}

function closeServicePurchaseModal() {
    const modal = document.getElementById('editServicePurchaseModal');
    if (modal) modal.style.display = 'none';
}


// ===== Ø¥Ø¯Ø§Ø±Ø© ÙØ±Ù‚ Mobile Medical Team =====

let mobileTeamData = [];
const MAX_MOBILE_TEAMS = 5;

async function loadMobileTeamsFromSupabase() {
    try {
        const data = await syncManager.loadData('mobileTeams');
        if (data && Array.isArray(data)) {
            mobileTeamData = data.slice(0, MAX_MOBILE_TEAMS);
            updateMobileTeamsDisplay();
        }
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ±Ù‚:', error);
    }
}

async function saveMobileTeamsData() {
    try {
        await syncManager.saveData('mobileTeams', mobileTeamData);
        localStorage.setItem('mobileTeams', JSON.stringify(mobileTeamData));
    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙØ±Ù‚:', error);
    }
}

function updateMobileTeamsDisplay() {
    const totalCount = mobileTeamData.reduce((sum, team) => sum + (team.teamsCount || 0), 0);
    document.getElementById('mobileTeamTotalCount').textContent = totalCount;
    const listContainer = document.getElementById('mobileTeamsList');
    listContainer.innerHTML = '';
    if (mobileTeamData.length === 0) {
        listContainer.innerHTML = '<p class="text-blue-300 text-xs text-center py-1">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ Ù…Ø¶Ø§ÙØ©</p>';
    } else {
        mobileTeamData.forEach((team) => {
            const teamDiv = document.createElement('div');
            teamDiv.className = 'flex justify-between items-center text-xs bg-blue-500/10 rounded-lg p-1.5 border border-blue-300/20';
            teamDiv.innerHTML = `<span class="text-blue-300">${team.facilityName}</span><span class="text-blue-200 font-semibold">${team.teamsCount}</span>`;
            listContainer.appendChild(teamDiv);
        });
    }
}

function openMobileTeamModal() {
    if (!isAdminMode) return;
    const modal = document.getElementById('editMobileTeamModal');
    if (modal) {
        updateMobileTeamsList();
        modal.style.display = 'flex';
    }
}

function closeMobileTeamModal() {
    const modal = document.getElementById('editMobileTeamModal');
    if (modal) modal.style.display = 'none';
}

function updateMobileTeamsList() {
    const container = document.getElementById('mobileTeamsListContainer');
    container.innerHTML = '';
    if (mobileTeamData.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±Ù‚ Ù…Ø¶Ø§ÙØ©</p>';
    } else {
        mobileTeamData.forEach((team, index) => {
            const teamDiv = document.createElement('div');
            teamDiv.className = 'flex justify-between items-center bg-gray-700/30 rounded-lg p-2 mb-2';
            teamDiv.innerHTML = `<div><p class="text-white text-sm font-semibold">${team.facilityName}</p><p class="text-gray-400 text-xs">Ø¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚: ${team.teamsCount}</p></div><button onclick="deleteMobileTeam(${index})" class="bg-red-500/20 hover:bg-red-500/40 text-red-300 px-2 py-1 rounded text-xs">Ø­Ø°Ù</button>`;
            container.appendChild(teamDiv);
        });
    }
}

function addMobileTeam() {
    if (mobileTeamData.length >= MAX_MOBILE_TEAMS) {
        showNotification('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰', `Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† ${MAX_MOBILE_TEAMS} Ù…Ù†Ø´Ø¢Øª`, 'error');
        return;
    }
    const facilityInput = document.getElementById('mobileTeamFacilityInput');
    const teamsInput = document.getElementById('mobileTeamTeamsInput');
    const facilityName = facilityInput.value.trim();
    const teamsCount = parseInt(teamsInput.value) || 0;
    if (!facilityName || teamsCount <= 0) {
        showNotification('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„ÙØ±Ù‚', 'error');
        return;
    }
    mobileTeamData.push({ facilityName, teamsCount });
    saveMobileTeamsData().then(() => {
        updateMobileTeamsDisplay();
        updateMobileTeamsList();
        facilityInput.value = '';
        teamsInput.value = '';
        showNotification('ØªÙ… Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    });
}

function deleteMobileTeam(index) {
    mobileTeamData.splice(index, 1);
    saveMobileTeamsData().then(() => {
        updateMobileTeamsDisplay();
        updateMobileTeamsList();
        showNotification('ØªÙ… Ø§Ù„Ø­Ø°Ù', 'ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    });
}


// ===== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© =====

// Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©
let customFacilities = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ù…Ù† Supabase Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
async function loadCustomFacilitiesFromSupabase() {
    try {
        const data = await syncManager.loadData('customFacilities');
        if (data) {
            customFacilities = Array.isArray(data) ? data : [];
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ù…Ù† Supabase:', customFacilities.length);
        } else {
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù† localStorage ÙƒÙ€ fallback
            const localData = localStorage.getItem('customFacilities');
            customFacilities = localData ? JSON.parse(localData) : [];
            console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ù…Ù† localStorage:', customFacilities.length);
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª:', error);
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ù† localStorage ÙƒÙ€ fallback
        const localData = localStorage.getItem('customFacilities');
        customFacilities = localData ? JSON.parse(localData) : [];
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', loadCustomFacilitiesFromSupabase);

// ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´Ø£Ø©
function openFacilityModal() {
    document.getElementById('addFacilityModal').style.display = 'flex';
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    if (window.syncIntervalId) {
        clearInterval(window.syncIntervalId);
        window.syncIntervalId = null;
        console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
    }
}

// Ø¥ØºÙ„Ø§Ù‚ Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´Ø£Ø©
function closeFacilityModal() {
    console.log('Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©');
    const modal = document.getElementById('addFacilityModal');
    if (modal) {
        modal.style.display = 'none';
        console.log('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ù†Ø¬Ø§Ø­');
        
        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        document.getElementById('facilityName').value = '';
        document.getElementById('facilityColor').value = 'green';
        document.getElementById('facilityEmergencyOccupied').value = '';
        document.getElementById('facilityEmergencyTotal').value = '';
        document.getElementById('facilityIcuOccupied').value = '';
        document.getElementById('facilityIcuTotal').value = '';
        document.getElementById('facilityCcuOccupied').value = '';
        document.getElementById('facilityCcuTotal').value = '';
        document.getElementById('facilityPicuOccupied').value = '';
        document.getElementById('facilityPicuTotal').value = '';
        document.getElementById('facilityNicuOccupied').value = '';
        document.getElementById('facilityNicuTotal').value = '';
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
        console.log('âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©');
        renderCustomFacilities();
    } else {
        console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©');
    }
}

// Ø­ÙØ¸ Ù…Ù†Ø´Ø£Ø© Ø¬Ø¯ÙŠØ¯Ø©
function saveFacility() {
    const name = document.getElementById('facilityName').value.trim();
    const color = document.getElementById('facilityColor').value;
    const emergencyOccupied = parseInt(document.getElementById('facilityEmergencyOccupied').value) || 0;
    const emergencyTotal = parseInt(document.getElementById('facilityEmergencyTotal').value) || 0;
    const icuOccupied = parseInt(document.getElementById('facilityIcuOccupied').value) || 0;
    const icuTotal = parseInt(document.getElementById('facilityIcuTotal').value) || 0;
    const ccuOccupied = parseInt(document.getElementById('facilityCcuOccupied').value) || 0;
    const ccuTotal = parseInt(document.getElementById('facilityCcuTotal').value) || 0;
    const picuOccupied = parseInt(document.getElementById('facilityPicuOccupied').value) || 0;
    const picuTotal = parseInt(document.getElementById('facilityPicuTotal').value) || 0;
    const nicuOccupied = parseInt(document.getElementById('facilityNicuOccupied').value) || 0;
    const nicuTotal = parseInt(document.getElementById('facilityNicuTotal').value) || 0;

    if (!name) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©');
        return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
    if (emergencyOccupied > emergencyTotal || icuOccupied > icuTotal || ccuOccupied > ccuTotal || 
        picuOccupied > picuTotal || nicuOccupied > nicuTotal) {
        alert('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
        return;
    }

    const facility = {
        id: Date.now(), // Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯
        name: name,
        color: color,
        emergency: { occupied: emergencyOccupied, total: emergencyTotal },
        icu: { occupied: icuOccupied, total: icuTotal },
        ccu: { occupied: ccuOccupied, total: ccuTotal },
        picu: { occupied: picuOccupied, total: picuTotal },
        nicu: { occupied: nicuOccupied, total: nicuTotal }
    };

    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸
    window.stopSync();
    console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
    
    customFacilities.push(facility);
    localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
    console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´Ø£Ø©:', facility);
    
    renderCustomFacilities();
    console.log('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª');
    
    closeFacilityModal();
    console.log('ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ closeFacilityModal');
    
    alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    
    // ØªØ­Ø¯ÙŠØ« Supabase Ù…Ø¨Ø§Ø´Ø±Ø©
    if (typeof syncManager !== 'undefined' && syncManager.saveData) {
        syncManager.saveData('customFacilities', customFacilities).then(() => {
            console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Supabase');
        }).catch(error => {
            console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
        });
    } else {
        console.warn('âš ï¸ syncManager ØºÙŠØ± Ù…ØªØ§Ø­ - Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙ‚Ø· ÙÙŠ localStorage');
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ø®ØµØµØ©
function renderCustomFacilities() {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©
    const customContainer = document.getElementById('customCentersContainer');
    if (!customContainer) {
        console.error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ©');
        return;
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    customContainer.innerHTML = '';
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    customFacilities.forEach(facility => {
        const cardHTML = createFacilityCardHTML(facility);
        customContainer.insertAdjacentHTML('beforeend', cardHTML);
    });
    
    // Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø§Ø¡Ù” Ø¹Ù„Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©
    const deleteButtons = customContainer.querySelectorAll('.custom-facility-card button');
    deleteButtons.forEach(btn => {
        if (isAdminMode) {
            btn.style.display = 'block';
        } else {
            btn.style.display = 'none';
        }
    });
}

// Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†Ø´Ø£Ø©
function createFacilityCardHTML(facility) {
    const colorClasses = {
        green: 'from-green-500/20 to-green-600/10 border-green-300/20',
        orange: 'from-orange-500/20 to-orange-600/10 border-orange-300/20',
        teal: 'from-teal-500/20 to-teal-600/10 border-teal-300/20',
        indigo: 'from-indigo-500/20 to-indigo-600/10 border-indigo-300/20',
        red: 'from-red-500/20 to-red-600/10 border-red-300/20',
        yellow: 'from-yellow-500/20 to-yellow-600/10 border-yellow-300/20'
    };

    const textColorClasses = {
        green: 'text-green-200',
        orange: 'text-orange-200',
        teal: 'text-teal-200',
        indigo: 'text-indigo-200',
        red: 'text-red-200',
        yellow: 'text-yellow-200'
    };

    const borderColorClasses = {
        green: 'border-green-300/20',
        orange: 'border-orange-300/20',
        teal: 'border-teal-300/20',
        indigo: 'border-indigo-300/20',
        red: 'border-red-300/20',
        yellow: 'border-yellow-300/20'
    };

    const slashColorClasses = {
        green: 'text-green-300',
        orange: 'text-orange-300',
        teal: 'text-teal-300',
        indigo: 'text-indigo-300',
        red: 'text-red-300',
        yellow: 'text-yellow-300'
    };

    const colorClass = colorClasses[facility.color] || colorClasses.green;
    const textColorClass = textColorClasses[facility.color] || textColorClasses.green;
    const borderColorClass = borderColorClasses[facility.color] || borderColorClasses.green;
    const slashColorClass = slashColorClasses[facility.color] || slashColorClasses.green;

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (!facility.emergency) facility.emergency = { occupied: 0, total: 0 };
    if (!facility.icu) facility.icu = { occupied: 0, total: 0 };
    if (!facility.ccu) facility.ccu = { occupied: 0, total: 0 };
    if (!facility.picu) facility.picu = { occupied: 0, total: 0 };
    if (!facility.nicu) facility.nicu = { occupied: 0, total: 0 };
    
    const emergencyPercent = facility.emergency.total > 0 ? Math.round((facility.emergency.occupied / facility.emergency.total) * 100) : 0;
    const icuPercent = facility.icu.total > 0 ? Math.round((facility.icu.occupied / facility.icu.total) * 100) : 0;
    const ccuPercent = facility.ccu.total > 0 ? Math.round((facility.ccu.occupied / facility.ccu.total) * 100) : 0;
    const picuPercent = facility.picu && facility.picu.total > 0 ? Math.round((facility.picu.occupied / facility.picu.total) * 100) : 0;
    const nicuPercent = facility.nicu && facility.nicu.total > 0 ? Math.round((facility.nicu.occupied / facility.nicu.total) * 100) : 0;

    // Ø¥Ù†Ø´Ø§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
    let bedsHTML = '';
    
    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©
    const getBedPercentColor = (percent) => {
        if (percent >= 75) return '#ef4444'; // Ø£Ø­Ù…Ø± - Ø®Ø·ÙŠØ±
        if (percent >= 50) return '#f97316'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ - ØªØ­Ø°ÙŠØ±
        return '#10b981'; // Ø£Ø®Ø¶Ø± - Ø¢Ù…Ù†
    };

    // Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦
    if (facility.emergency.total > 0) {
        const emergencyPercentColor = getBedPercentColor(emergencyPercent);
        bedsHTML += `
            <div class="mb-1 pb-1 border-b ${borderColorClass}">
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-xl font-extrabold">ER</p>
                    <p class="text-xl font-bold" style="color: ${emergencyPercentColor};">${emergencyPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xl font-bold text-white">${facility.emergency.occupied}</span>
                    <span class="${slashColorClass} text-sm mx-0.5">/</span>
                    <span class="text-lg text-white">${facility.emergency.total}</span>
                </div>
            </div>
        `;
    }
    
    // Ø£Ø³Ø±Ø© ICU
    if (facility.icu.total > 0) {
        const icuPercentColor = getBedPercentColor(icuPercent);
        bedsHTML += `
            <div class="mb-1 pb-1 border-b ${borderColorClass}">
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-xl font-extrabold">ICU</p>
                    <p class="text-xl font-bold" style="color: ${icuPercentColor};">${icuPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xl font-bold text-white">${facility.icu.occupied}</span>
                    <span class="${slashColorClass} text-sm mx-0.5">/</span>
                    <span class="text-lg text-white">${facility.icu.total}</span>
                </div>
            </div>
        `;
    }
    
    // Ø£Ø³Ø±Ø© CCU
    if (facility.ccu.total > 0) {
        const ccuPercentColor = getBedPercentColor(ccuPercent);
        bedsHTML += `
            <div class="mb-1 pb-1 border-b ${borderColorClass}">
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-xl font-extrabold">CCU</p>
                    <p class="text-xl font-bold" style="color: ${ccuPercentColor};">${ccuPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xl font-bold text-white">${facility.ccu.occupied}</span>
                    <span class="${slashColorClass} text-sm mx-0.5">/</span>
                    <span class="text-lg text-white">${facility.ccu.total}</span>
                </div>
            </div>
        `;
    }
    
    // Ø£Ø³Ø±Ø© PICU
    if (facility.picu.total > 0) {
        const picuPercentColor = getBedPercentColor(picuPercent);
        bedsHTML += `
            <div class="mb-1 pb-1 border-b ${borderColorClass}">
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-xl font-extrabold">PICU</p>
                    <p class="text-xl font-bold" style="color: ${picuPercentColor};">${picuPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xl font-bold text-white">${facility.picu.occupied}</span>
                    <span class="${slashColorClass} text-sm mx-0.5">/</span>
                    <span class="text-lg text-white">${facility.picu.total}</span>
                </div>
            </div>
        `;
    }
    
    // Ø£Ø³Ø±Ø© NICU (Ø¢Ø®Ø± Ù‚Ø³Ù… Ø¨Ø¯ÙˆÙ† border-b)
    if (facility.nicu && facility.nicu.total > 0) {
        const nicuPercentColor = getBedPercentColor(nicuPercent);
        bedsHTML += `
            <div>
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-xl font-extrabold">NICU</p>
                    <p class="text-xl font-bold" style="color: ${nicuPercentColor};">${nicuPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-xl font-bold text-white">${facility.nicu.occupied}</span>
                    <span class="${slashColorClass} text-sm mx-0.5">/</span>
                    <span class="text-lg text-white">${facility.nicu.total}</span>
                </div>
            </div>
        `;
    }

    // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù„ÙˆÙ† Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ù…ÙˆØ§Ø±Ø¯ (Ù…Ø¹Ø§ÙƒØ³ Ù„Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©)
    const getResourcePercentColor = (percent) => {
        if (percent >= 75) return '#10b981'; // Ø£Ø®Ø¶Ø± - Ù…Ù…ØªØ§Ø²
        if (percent >= 50) return '#f97316'; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ - ØªØ­Ø°ÙŠØ±
        return '#ef4444'; // Ø£Ø­Ù…Ø± - Ø­Ø±Ø¬
    };

    // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª/Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    let resourcesHTML = '';
    if (facility.vehicles && facility.vehicles.total > 0) {
        const vehiclesPercent = facility.vehicles.total > 0 ? Math.round((facility.vehicles.available / facility.vehicles.total) * 100) : 0;
        const vehiclesPercentColor = getResourcePercentColor(vehiclesPercent);
        resourcesHTML += `
            <div class="mb-1 pb-1 border-b ${borderColorClass}">
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-lg font-extrabold">ğŸš—</p>
                    <p class="text-lg font-bold" style="color: ${vehiclesPercentColor};">${vehiclesPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-lg font-bold text-white">${facility.vehicles.available}</span>
                    <span class="${slashColorClass} text-xs mx-0.5">/</span>
                    <span class="text-sm text-white">${facility.vehicles.total}</span>
                </div>
            </div>
        `;
    }

    if (facility.staff && facility.staff.total > 0) {
        const staffPercent = facility.staff.total > 0 ? Math.round((facility.staff.available / facility.staff.total) * 100) : 0;
        const staffPercentColor = getResourcePercentColor(staffPercent);
        resourcesHTML += `
            <div>
                <div class="flex items-center justify-between mb-0.5">
                    <p class="${textColorClass} text-lg font-extrabold">ğŸ‘¥</p>
                    <p class="text-lg font-bold" style="color: ${staffPercentColor};">${staffPercent}%</p>
                </div>
                <div class="flex items-baseline">
                    <span class="text-lg font-bold text-white">${facility.staff.available}</span>
                    <span class="${slashColorClass} text-xs mx-0.5">/</span>
                    <span class="text-sm text-white">${facility.staff.total}</span>
                </div>
            </div>
        `;
    }

    const deleteButtonHTML = isAdminMode ? `<button onclick="event.stopPropagation(); deleteCustomFacility(${facility.id})" class="text-red-400 hover:text-red-300 text-xs">ğŸ—‘ï¸</button>` : '';
    const editBedsButtonHTML = isAdminMode ? `<button onclick="event.stopPropagation(); editCustomFacilityBeds(${facility.id})" class="text-blue-400 hover:text-blue-300 text-xs ml-1">âœï¸</button>` : '';
    const editNameButtonHTML = isAdminMode ? `<button onclick="event.stopPropagation(); editFacilityName(${facility.id})" class="text-yellow-400 hover:text-yellow-300 text-xs ml-1">ğŸ“</button>` : '';
    const onClickHandler = isAdminMode ? `onclick="editCustomFacility(${facility.id})"` : '';
    const cursorStyle = isAdminMode ? 'cursor-pointer' : '';

    return `
        <div class="custom-facility-card bg-gradient-to-br ${colorClass} backdrop-blur-lg rounded-xl p-3 border transition-all duration-300 hover:shadow-2xl hover:shadow-blue-500/50 hover:-translate-y-2 cursor-pointer" ${onClickHandler}>
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-white font-bold text-sm">ğŸ¥ ${facility.name}</h3>
                <div class="flex items-center gap-0.5">
                    ${editNameButtonHTML}
                    ${editBedsButtonHTML}
                    ${deleteButtonHTML}
                </div>
            </div>
            <div class="space-y-1.5">
                ${bedsHTML}
                ${resourcesHTML}
            </div>
        </div>
    `;
}

// Ø­Ø°Ù Ù…Ù†Ø´Ø£Ø© Ù…Ø®ØµØµØ©
function deleteCustomFacility(facilityId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø´Ø£Ø©ØŸ')) {
        customFacilities = customFacilities.filter(f => f.id !== facilityId);
        localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
        renderCustomFacilities();
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        
        // ØªØ­Ø¯ÙŠØ« Supabase Ù…Ø¨Ø§Ø´Ø±Ø©
        if (typeof syncManager !== 'undefined' && syncManager.saveData) {
            syncManager.saveData('customFacilities', customFacilities).then(() => {
                console.log('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
            }).catch(error => {
                console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            });
        } else {
            console.warn('âš ï¸ syncManager ØºÙŠØ± Ù…ØªØ§Ø­ - Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù ÙÙ‚Ø· Ù…Ù† localStorage');
        }
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø´Ø£Ø© Ù…Ø®ØµØµØ©
function editCustomFacility(facilityId) {
    const facility = customFacilities.find(f => f.id === facilityId);
    if (!facility) return;

    // ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    document.getElementById('facilityName').value = facility.name;
    document.getElementById('facilityColor').value = facility.color;
    document.getElementById('facilityEmergencyOccupied').value = facility.emergency.occupied;
    document.getElementById('facilityEmergencyTotal').value = facility.emergency.total;
    document.getElementById('facilityIcuOccupied').value = facility.icu.occupied;
    document.getElementById('facilityIcuTotal').value = facility.icu.total;
    document.getElementById('facilityCcuOccupied').value = facility.ccu.occupied;
    document.getElementById('facilityCcuTotal').value = facility.ccu.total;

    // ØªØºÙŠÙŠØ± ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø¥Ø¶Ø§ÙØ©
    const saveButton = document.querySelector('#addFacilityModal .btn-success');
    saveButton.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´Ø£Ø©';
    saveButton.onclick = function() {
        updateCustomFacility(facilityId);
    };

    document.getElementById('addFacilityModal').style.display = 'flex';
}

// ØªØ­Ø¯ÙŠØ« Ù…Ù†Ø´Ø£Ø© Ù…Ø®ØµØµØ©
function updateCustomFacility(facilityId) {
    const name = document.getElementById('facilityName').value.trim();
    const color = document.getElementById('facilityColor').value;
    const emergencyOccupied = parseInt(document.getElementById('facilityEmergencyOccupied').value) || 0;
    const emergencyTotal = parseInt(document.getElementById('facilityEmergencyTotal').value) || 0;
    const icuOccupied = parseInt(document.getElementById('facilityIcuOccupied').value) || 0;
    const icuTotal = parseInt(document.getElementById('facilityIcuTotal').value) || 0;
    const ccuOccupied = parseInt(document.getElementById('facilityCcuOccupied').value) || 0;
    const ccuTotal = parseInt(document.getElementById('facilityCcuTotal').value) || 0;

    if (!name) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©');
        return;
    }

    if (emergencyOccupied > emergencyTotal || icuOccupied > icuTotal || ccuOccupied > ccuTotal) {
        alert('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
        return;
    }

    const facilityIndex = customFacilities.findIndex(f => f.id === facilityId);
    if (facilityIndex !== -1) {
        customFacilities[facilityIndex] = {
            ...customFacilities[facilityIndex],
            name: name,
            color: color,
            emergency: { occupied: emergencyOccupied, total: emergencyTotal },
            icu: { occupied: icuOccupied, total: icuTotal },
            ccu: { occupied: ccuOccupied, total: ccuTotal }
        };

        localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
        renderCustomFacilities();
        closeFacilityModal();
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„Ø­ÙØ¸
        const saveButton = document.querySelector('#addFacilityModal .btn-success');
        saveButton.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø©';
        saveButton.onclick = saveFacility;
        
        alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© ÙÙ‚Ø· Ù„Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„Ù…Ø®ØµØµØ©
function editCustomFacilityBeds(facilityId) {
    const facility = customFacilities.find(f => f.id === facilityId);
    if (!facility) return;

    // ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„Ø£Ø³Ø±Ø© ÙÙ‚Ø·
    document.getElementById('facilityName').value = facility.name;
    document.getElementById('facilityColor').value = facility.color;
    document.getElementById('facilityEmergencyOccupied').value = facility.emergency.occupied;
    document.getElementById('facilityEmergencyTotal').value = facility.emergency.total;
    document.getElementById('facilityIcuOccupied').value = facility.icu.occupied;
    document.getElementById('facilityIcuTotal').value = facility.icu.total;
    document.getElementById('facilityCcuOccupied').value = facility.ccu.occupied;
    document.getElementById('facilityCcuTotal').value = facility.ccu.total;
    document.getElementById('facilityPicuOccupied').value = facility.picu ? facility.picu.occupied : 0;
    document.getElementById('facilityPicuTotal').value = facility.picu ? facility.picu.total : 0;
    document.getElementById('facilityNicuOccupied').value = facility.nicu ? facility.nicu.occupied : 0;
    document.getElementById('facilityNicuTotal').value = facility.nicu ? facility.nicu.total : 0;

    // ØªØºÙŠÙŠØ± ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© ÙÙ‚Ø·
    const saveButton = document.querySelector('#addFacilityModal .btn-success');
    saveButton.textContent = 'ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ©';
    saveButton.onclick = function() {
        updateCustomFacilityBeds(facilityId);
    };

    document.getElementById('addFacilityModal').style.display = 'flex';
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© ÙÙ‚Ø·
function updateCustomFacilityBeds(facilityId) {
    const emergencyOccupied = parseInt(document.getElementById('facilityEmergencyOccupied').value) || 0;
    const emergencyTotal = parseInt(document.getElementById('facilityEmergencyTotal').value) || 0;
    const icuOccupied = parseInt(document.getElementById('facilityIcuOccupied').value) || 0;
    const icuTotal = parseInt(document.getElementById('facilityIcuTotal').value) || 0;
    const ccuOccupied = parseInt(document.getElementById('facilityCcuOccupied').value) || 0;
    const ccuTotal = parseInt(document.getElementById('facilityCcuTotal').value) || 0;
    const picuOccupied = parseInt(document.getElementById('facilityPicuOccupied').value) || 0;
    const picuTotal = parseInt(document.getElementById('facilityPicuTotal').value) || 0;
    const nicuOccupied = parseInt(document.getElementById('facilityNicuOccupied').value) || 0;
    const nicuTotal = parseInt(document.getElementById('facilityNicuTotal').value) || 0;

    if (emergencyOccupied > emergencyTotal || icuOccupied > icuTotal || ccuOccupied > ccuTotal || picuOccupied > picuTotal || nicuOccupied > nicuTotal) {
        alert('Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
        return;
    }

    const facilityIndex = customFacilities.findIndex(f => f.id === facilityId);
    if (facilityIndex !== -1) {
        customFacilities[facilityIndex].emergency = { occupied: emergencyOccupied, total: emergencyTotal };
        customFacilities[facilityIndex].icu = { occupied: icuOccupied, total: icuTotal };
        customFacilities[facilityIndex].ccu = { occupied: ccuOccupied, total: ccuTotal };
        if (picuTotal > 0) {
            customFacilities[facilityIndex].picu = { occupied: picuOccupied, total: picuTotal };
        }
        if (nicuTotal > 0) {
            customFacilities[facilityIndex].nicu = { occupied: nicuOccupied, total: nicuTotal };
        }

        localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
        renderCustomFacilities();
        closeFacilityModal();
        
        // Ø­ÙØ¸ ÙÙŠ Supabase
        if (typeof syncManager !== 'undefined' && syncManager.saveData) {
            syncManager.saveData('customFacilities', customFacilities).then(() => {
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© ÙÙŠ Supabase');
            }).catch(error => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
            });
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„Ø­ÙØ¸
        const saveButton = document.querySelector('#addFacilityModal .btn-success');
        saveButton.textContent = 'Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†Ø´Ø£Ø©';
        saveButton.onclick = saveFacility;
        
        alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø© Ø§Ù„Ø³Ø±ÙŠØ±ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!');
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø©
function editFacilityName(facilityId) {
    const facility = customFacilities.find(f => f.id === facilityId);
    if (!facility) return;

    const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ù†Ø´Ø£Ø©:', facility.name);
    
    if (newName && newName.trim() !== '') {
        facility.name = newName.trim();
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
        
        // Ø­ÙØ¸ ÙÙŠ Supabase
        if (typeof syncManager !== 'undefined' && syncManager.saveData) {
            syncManager.saveData('customFacilities', customFacilities).then(() => {
                console.log('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Supabase');
            }).catch(err => {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Supabase:', err);
            });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        renderFacilitiesCards();
        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø´Ø£Ø© Ø¨Ù†Ø¬Ø§Ø­!');
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø±Ø© Ù„Ù„Ù…Ù†Ø´Ø¢Øª Ù…Ù† Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù†Ø´Ø¢Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function editFacilityBeds(facilityId) {
    const facility = customFacilities.find(f => f.id === facilityId);
    if (!facility) return;

    const modalHTML = `
        <div id="editFacilityBedsModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" style="display: flex;">
            <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-2xl p-6 border border-indigo-300/20 max-w-2xl w-full mx-4 max-h-90vh overflow-y-auto">
                <h2 class="text-white text-2xl font-bold mb-6">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø±Ø© - ${facility.name}</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-indigo-800/30 rounded-lg p-4 border border-indigo-300/20">
                        <h3 class="text-indigo-200 font-bold mb-3">ER (Ø£Ø³Ø±Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦)</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</label>
                                <input type="number" id="editErOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.emergency?.occupied || 0}" min="0">
                            </div>
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <input type="number" id="editErTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.emergency?.total || 0}" min="0">
                            </div>
                            <div class="text-indigo-300 text-xs mt-2" id="erPercent">0%</div>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-800/30 rounded-lg p-4 border border-indigo-300/20">
                        <h3 class="text-indigo-200 font-bold mb-3">ICU (Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ²Ø©)</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</label>
                                <input type="number" id="editIcuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.icu?.occupied || 0}" min="0">
                            </div>
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <input type="number" id="editIcuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.icu?.total || 0}" min="0">
                            </div>
                            <div class="text-indigo-300 text-xs mt-2" id="icuPercent">0%</div>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-800/30 rounded-lg p-4 border border-indigo-300/20">
                        <h3 class="text-indigo-200 font-bold mb-3">CCU (Ø§Ù„Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù‚Ù„Ø¨ÙŠØ©)</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</label>
                                <input type="number" id="editCcuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.ccu?.occupied || 0}" min="0">
                            </div>
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <input type="number" id="editCcuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.ccu?.total || 0}" min="0">
                            </div>
                            <div class="text-indigo-300 text-xs mt-2" id="ccuPercent">0%</div>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-800/30 rounded-lg p-4 border border-indigo-300/20">
                        <h3 class="text-indigo-200 font-bold mb-3">PICU (Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø£Ø·ÙØ§Ù„)</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</label>
                                <input type="number" id="editPicuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.picu?.occupied || 0}" min="0">
                            </div>
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <input type="number" id="editPicuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.picu?.total || 0}" min="0">
                            </div>
                            <div class="text-indigo-300 text-xs mt-2" id="picuPercent">0%</div>
                        </div>
                    </div>
                    
                    <div class="bg-indigo-800/30 rounded-lg p-4 border border-indigo-300/20">
                        <h3 class="text-indigo-200 font-bold mb-3">NICU (Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ù…ÙˆØ§Ù„ÙŠØ¯)</h3>
                        <div class="space-y-2">
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø©</label>
                                <input type="number" id="editNicuOccupied" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.nicu?.occupied || 0}" min="0">
                            </div>
                            <div>
                                <label class="text-indigo-300 text-sm">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                                <input type="number" id="editNicuTotal" class="w-full p-2 rounded-lg bg-white/10 border border-white/20 text-white" value="${facility.nicu?.total || 0}" min="0">
                            </div>
                            <div class="text-indigo-300 text-xs mt-2" id="nicuPercent">0%</div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3 space-x-reverse">
                    <button onclick="saveFacilityBedsChanges(${facilityId})" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
                    <button onclick="closeFacilityBedsModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
    `;
    
    const existingModal = document.getElementById('editFacilityBedsModal');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    const inputs = ['editErOccupied', 'editErTotal', 'editIcuOccupied', 'editIcuTotal', 'editCcuOccupied', 'editCcuTotal', 'editPicuOccupied', 'editPicuTotal', 'editNicuOccupied', 'editNicuTotal'];
    inputs.forEach(id => {
        const input = document.getElementById(id);
        if (input) input.addEventListener('input', updatePercentages);
    });
    
    updatePercentages();
}

function updatePercentages() {
    const updatePercent = (occupiedId, totalId, percentId) => {
        const occupied = parseInt(document.getElementById(occupiedId)?.value || 0);
        const total = parseInt(document.getElementById(totalId)?.value || 0);
        const percent = total > 0 ? Math.round((occupied / total) * 100) : 0;
        const percentElement = document.getElementById(percentId);
        if (percentElement) {
            percentElement.textContent = `${percent}%`;
            if (percent >= 75) percentElement.style.color = '#ef4444';
            else if (percent >= 50) percentElement.style.color = '#f97316';
            else percentElement.style.color = '#10b981';
        }
    };
    
    updatePercent('editErOccupied', 'editErTotal', 'erPercent');
    updatePercent('editIcuOccupied', 'editIcuTotal', 'icuPercent');
    updatePercent('editCcuOccupied', 'editCcuTotal', 'ccuPercent');
    updatePercent('editPicuOccupied', 'editPicuTotal', 'picuPercent');
    updatePercent('editNicuOccupied', 'editNicuTotal', 'nicuPercent');
}

function closeFacilityBedsModal() {
    const modal = document.getElementById('editFacilityBedsModal');
    if (modal) modal.remove();
}

function saveFacilityBedsChanges(facilityId) {
    const erOccupied = parseInt(document.getElementById('editErOccupied')?.value || 0);
    const erTotal = parseInt(document.getElementById('editErTotal')?.value || 0);
    const icuOccupied = parseInt(document.getElementById('editIcuOccupied')?.value || 0);
    const icuTotal = parseInt(document.getElementById('editIcuTotal')?.value || 0);
    const ccuOccupied = parseInt(document.getElementById('editCcuOccupied')?.value || 0);
    const ccuTotal = parseInt(document.getElementById('editCcuTotal')?.value || 0);
    const picuOccupied = parseInt(document.getElementById('editPicuOccupied')?.value || 0);
    const picuTotal = parseInt(document.getElementById('editPicuTotal')?.value || 0);
    const nicuOccupied = parseInt(document.getElementById('editNicuOccupied')?.value || 0);
    const nicuTotal = parseInt(document.getElementById('editNicuTotal')?.value || 0);
    
    if (erOccupied > erTotal || icuOccupied > icuTotal || ccuOccupied > ccuTotal || picuOccupied > picuTotal || nicuOccupied > nicuTotal) {
        alert('âŒ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø±Ø© Ø§Ù„Ù…Ø´ØºÙˆÙ„Ø© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ');
        return;
    }
    
    const facilityIndex = customFacilities.findIndex(f => f.id === facilityId);
    if (facilityIndex !== -1) {
        customFacilities[facilityIndex].emergency = { occupied: erOccupied, total: erTotal };
        customFacilities[facilityIndex].icu = { occupied: icuOccupied, total: icuTotal };
        customFacilities[facilityIndex].ccu = { occupied: ccuOccupied, total: ccuTotal };
        customFacilities[facilityIndex].picu = { occupied: picuOccupied, total: picuTotal };
        customFacilities[facilityIndex].nicu = { occupied: nicuOccupied, total: nicuTotal };
        
        // Ø­ÙØ¸ ÙÙŠ localStorage
        localStorage.setItem('customFacilities', JSON.stringify(customFacilities));
        
        // Ø­ÙØ¸ ÙÙŠ Supabase
        if (typeof syncManager !== 'undefined' && syncManager.saveData) {
            syncManager.saveData('customFacilities', customFacilities).then(() => {
                console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                renderFacilitiesCards();
                closeFacilityBedsModal();
                alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(err => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Supabase:', err);
            });
        } else {
            console.warn('âš ï¸ syncManager ØºÙŠØ± Ù…ØªØ§Ø­ - Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ ÙÙ‚Ø· ÙÙŠ localStorage');
            renderFacilitiesCards();
            closeFacilityBedsModal();
            alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        }
    }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„Ù…Ø®ØµØµØ© Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
document.addEventListener('DOMContentLoaded', function() {
    renderCustomFacilities();
});

    </script>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js"></script>
<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCDJuqoWLowt4gnzdReCtcCLCywNqSoj_Q",
  authDomain: "dashboard-a7c4c.firebaseapp.com",
  databaseURL: "https://dashboard-a7c4c-default-rtdb.firebaseio.com",
  projectId: "dashboard-a7c4c",
  storageBucket: "dashboard-a7c4c.firebasestorage.app",
  messagingSenderId: "902429954750",
  appId: "1:902429954750:web:77cc0c2ca78150e45a04ef",
  measurementId: "G-PFT1CE957T"
};

// ØªÙ‡ÙŠØ¦Ø© Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firebase
function saveDataToFirebase(key, data) {
  database.ref(key).set(data).catch(error => console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸:', error));
}

// Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
function loadDataFromFirebase(key, callback) {
  database.ref(key).on('value', snapshot => {
    if (snapshot.exists()) {
      callback(snapshot.val());
    }
  });
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ²
const originalAddCenter = window.addCenter;
if (originalAddCenter) {
  window.addCenter = function() {
    originalAddCenter();
    // Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Firebase Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ² Ø¬Ø¯ÙŠØ¯
    setTimeout(() => {
      if (emergencyCenters && emergencyCenters.length > 0) {
        saveDataToFirebase('emergencyCenters', emergencyCenters);
        console.log('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø§ÙƒØ² ÙÙŠ Firebase:', emergencyCenters);
      }
    }, 500);
  };
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ù…Ø±ÙƒØ²
const originalUpdateCenter = window.updateCenter;
if (originalUpdateCenter) {
  window.updateCenter = function(centerId) {
    originalUpdateCenter(centerId);
    setTimeout(() => {
      if (emergencyCenters && emergencyCenters.length > 0) {
        saveDataToFirebase('emergencyCenters', emergencyCenters);
      }
    }, 500);
  };
}

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø­Ø°Ù Ù…Ø±ÙƒØ²
const originalDeleteCenter = window.deleteCenter;
if (originalDeleteCenter) {
  window.deleteCenter = function(centerId) {
    originalDeleteCenter(centerId);
    setTimeout(() => {
      if (emergencyCenters && emergencyCenters.length > 0) {
        saveDataToFirebase('emergencyCenters', emergencyCenters);
      } else {
        database.ref('emergencyCenters').remove();
      }
    }, 500);
  };
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', function() {
  setTimeout(() => {
    loadDataFromFirebase('emergencyCenters', function(data) {
      if (data && isAuthenticated) {
        emergencyCenters = data;
        updateMainStats();
        displayCenters();
        console.log('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase:', data);
      }
    });
  }, 1000);
});

// Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
setInterval(() => {
  if (isAuthenticated && emergencyCenters && emergencyCenters.length > 0) {
    saveDataToFirebase('emergencyCenters', emergencyCenters);
  }
}, 30000);

// ===== Ù†Ø¸Ø§Ù… Realtime Sync Ù…Ù† Supabase =====
// Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© Ù„Ù„Ù€ Supabase
let supabaseClient = null;
let realtimeChannel = null;

// Ø¥Ù†Ø´Ø§Ø¡ Supabase Client
function initializeSupabaseClient() {
    try {
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase
        const SUPABASE_URL = 'https://yytxgzksiheseorqhdqm.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5dHhnemtzaWhlc2VvcnFoZHFtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODc4MDgsImV4cCI6MjA4MTM2MzgwOH0.aReF32tD8LbY39nEMBqBUmU06V7o2nf-M_zmLJmVlyc';;
        
        if (typeof supabase !== 'undefined') {
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Supabase Client Ø¨Ù†Ø¬Ø§Ø­');
            return true;
        } else {
            console.warn('âš ï¸ Ù…ÙƒØªØ¨Ø© Supabase ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©');
            return false;
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Supabase Client:', error);
        return false;
    }
}

// ØªÙØ¹ÙŠÙ„ Realtime Listeners
function setupRealtimeListeners() {
    console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªÙØ¹ÙŠÙ„ Realtime Listeners...');
    
    try {
        // Ø¥Ù†Ø´Ø§Ø¡ Supabase Client Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if (!supabaseClient) {
            const initialized = initializeSupabaseClient();
            if (!initialized) {
                console.warn('âš ï¸ ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Supabase ClientØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Polling ÙÙ‚Ø·');
                return;
            }
        }
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙˆÙ„ emergency_centers
        realtimeChannel = supabaseClient
            .channel('emergency_centers_changes')
            .on(
                'postgres_changes',
                {
                    event: '*',
                    schema: 'public',
                    table: 'emergency_centers'
                },
                (payload) => {
                    console.log('ğŸ”” ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªØºÙŠÙŠØ± ÙÙŠ Ø¬Ø¯ÙˆÙ„ emergency_centers:', payload);
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ø§Ù‹
                    loadAllDataFromSupabase().then(() => {
                        console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Realtime');
                        
                        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­
                        forceUpdateAllCards();
                        
                    }).catch(error => {
                        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Realtime:', error);
                    });
                }
            )
            .subscribe((status) => {
                if (status === 'SUBSCRIBED') {
                    console.log('âœ… ØªÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Realtime Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                } else if (status === 'CLOSED') {
                    console.warn('âš ï¸ ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§ØªØµØ§Ù„ Realtime');
                } else if (status === 'CHANNEL_ERROR') {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ù†Ø§Ø© Realtime');
                }
            });
            
        console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Realtime Listeners Ø¨Ù†Ø¬Ø§Ø­');
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªÙØ¹ÙŠÙ„ Realtime Listeners:', error);
    }
}

// Ø¥ÙŠÙ‚Ø§Ù Realtime Listeners
function stopRealtimeListeners() {
    try {
        if (realtimeChannel && supabaseClient) {
            supabaseClient.removeChannel(realtimeChannel);
            console.log('â¸ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Realtime Listeners');
        }
    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Realtime Listeners:', error);
    }
}

// Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ…Ø¹ Ø¯Ø§Ø¦Ù… Ù„Ù„Ù€ BroadcastChannel (Ø®Ø§Ø±Ø¬ initializeDashboard)
if (typeof BroadcastChannel !== 'undefined') {
    const globalBroadcastChannel = new BroadcastChannel('emergency_dashboard_updates');
    globalBroadcastChannel.onmessage = (event) => {
        console.log('ğŸ”” Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ù…Ù† BroadcastChannel:', event.data);
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
        if (event.data.type === 'stats_updated') {
            console.log('ğŸ“¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† Ù†Ø§ÙØ°Ø© Ø£Ø®Ø±Ù‰');
            if (typeof updateMainStats === 'function') {
                updateMainStats();
                console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† BroadcastChannel');
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø±Ø§ÙƒØ²
        if (event.data.type === 'centers_updated') {
            console.log('ğŸ“¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø¥Ø³Ø¹Ø§ÙÙŠØ© Ù…Ù† Ù†Ø§ÙØ°Ø© Ø£Ø®Ø±Ù‰');
            if (typeof loadAllDataFromSupabase === 'function') {
                loadAllDataFromSupabase().then(() => {
                    console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Supabase');
                    console.log('emergencyCenters:', typeof emergencyCenters !== 'undefined' ? emergencyCenters : 'undefined');
                    console.log('Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ²:', emergencyCenters ? emergencyCenters.length : 0);
                    
                    // ØªØ£Ø®ÙŠØ± Ø£Ø·ÙˆÙ„ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ loadAllDataFromSupabase()
                    setTimeout(() => {
                        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ updateMainStats Ù…Ø¨Ø§Ø´Ø±Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                        if (typeof updateMainStats === 'function') {
                            console.log('ğŸ“¡ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ updateMainStats Ù…Ø¨Ø§Ø´Ø±Ø©...');
                            updateMainStats();
                            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©');
                        }
                        
                        if (typeof forceUpdateAllCards === 'function') {
                            console.log('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ forceUpdateAllCards...');
                            forceUpdateAllCards();
                            console.log('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù† BroadcastChannel');
                        }
                    }, 300);
                }).catch(error => {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                });
            }
        }
    };
    console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø³ØªÙ…Ø¹ BroadcastChannel Ø§Ù„Ø¯Ø§Ø¦Ù…');
}
</script>
</body>
</html>
